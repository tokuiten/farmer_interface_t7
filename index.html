<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂèéÁ©´„É≠„Éú„ÉÉ„ÉàÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f1f8e9;
            height: 100vh;
            overflow: hidden;
        }

        .header {
            background: #81c784;
            color: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header .status {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .status-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .main-container {
            display: flex;
            height: calc(100vh - 70px);
        }

        .settings-panel {
            width: 60%;
            background: white;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .map-panel {
            width: 40%;
            padding: 10px 20px 20px 30px;
            overflow: hidden;
            position: relative;
            background: #f1f8e9;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Ë®≠ÂÆö„Éë„Éç„É´„ÅÆ„Çπ„Çø„Ç§„É´ */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .robot-controls {
            border: 2px solid #a5d6a7;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background-color: #f1f8e9;
        }
        
        .robot-row {
            display: flex;
            gap: 15px;
            align-items: end;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: inline-block;
            margin: 5px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 20px;
        }
        
        select, button {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 20px;
        }
        
        select:disabled {
            background-color: #f5f5f5;
            color: #666;
            cursor: not-allowed;
        }
        
        button {
            background-color: #66bb6a;
            color: white;
            cursor: pointer;
            margin-left: 10px;
        }
        
        button:hover:not(:disabled) {
            background-color: #4caf50;
        }
        
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        #animateBtn {
            background-color: #81c784;
        }
        
        #animateBtn:hover:not(:disabled) {
            background-color: #66bb6a;
        }
        
        #stopBtn {
            background-color: #a5d6a7;
        }
        
        #stopBtn:hover:not(:disabled) {
            background-color: #81c784;
        }
        
        .control-buttons {
            text-align: center;
            margin-top: 20px;
        }

        /* „Éó„É™„Çª„ÉÉ„Éà„Çª„É¨„ÇØ„Çø„ÅÆ„Çπ„Çø„Ç§„É´ */
        .preset-selector {
            background: #a5d6a7;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .preset-selector label {
            color: white;
            font-weight: bold;
            font-size: 20px;
            display: block;
            margin-bottom: 10px;
        }

        .preset-selector select {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 20px;
            background: white;
            min-width: 250px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* „Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥„ÅÆ„Çπ„Çø„Ç§„É´ */
        .accordion-toggle {
            background: #f1f8e9;
            border: 2px solid #81c784;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            margin-bottom: 15px;
            transition: all 0.3s;
            user-select: none;
        }

        .accordion-toggle:hover {
            background: #e8f5e8;
        }

        .accordion-toggle.active {
            background: #81c784;
            color: white;
        }

        .accordion-toggle .icon {
            font-size: 20px;
            margin-left: 10px;
            transition: transform 0.3s;
        }

        .accordion-toggle.active .icon {
            transform: rotate(180deg);
        }

        .accordion-content {
            display: none;
            animation: slideDown 0.3s ease-out;
        }

        .accordion-content.active {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 1000px;
            }
        }

        /* Á∞°Êòì„Ç≥„É≥„Éà„É≠„Éº„É´„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´ */
        .quick-controls {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }

        .quick-controls .control-buttons {
            margin-top: 0;
        }

        /* „Éû„ÉÉ„ÉóÁî®„ÅÆ„Ç≠„É£„É≥„Éê„Çπ„Çπ„Çø„Ç§„É´ */
        #canvas {
            border: 2px solid #333;
            background-color: white;
            max-width: 100%;
            max-height: 100%;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }

            .settings-panel {
                width: 100%;
                height: 50vh;
            }

            .map-panel {
                width: 100%;
                height: 50vh;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            <span>ü§ñ</span>
            ÂèéÁ©´„É≠„Éú„ÉÉ„ÉàÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†
        </h1>
        <div class="status">
            <div class="status-item">
                üìÖ <span id="current-date"></span>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="settings-panel">
            
            <div style="text-align: center; margin-bottom: 15px;">
                <button onclick="showManual()" style="background-color: #81c784; color: white; font-size: 18px; padding: 10px 25px; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: inline-block;">
                    üìñ „Éû„Éã„É•„Ç¢„É´„ÇíË™≠„ÇÄ
                </button>
            </div>
            
            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: #e8f5e9; border-radius: 6px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="display: inline-block; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 10px solid #FF6B6B;"></span>
                            <span style="font-size: 20px;"><strong>„Åç„Å§„Å≠Âè∑</strong>: Â∑¶Âêë„ÅçÂèéÁ©´„É≠„Éú„ÉÉ„Éà</span>
                        </div>
                        <div id="robot1Status" style="background: rgba(165, 214, 167, 0.3); padding: 4px 12px; border-radius: 6px; font-size: 20px;">
                            <span id="robot1State">ÂÖÖÈõª‰∏≠</span>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: #e8f5e9; border-radius: 6px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="display: inline-block; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 10px solid #4A90E2;"></span>
                            <span style="font-size: 20px;"><strong>„Åü„Å¨„ÅçÂè∑</strong>: Âè≥Âêë„ÅçÂèéÁ©´„É≠„Éú„ÉÉ„Éà</span>
                        </div>
                        <div id="robot2Status" style="background: rgba(165, 214, 167, 0.3); padding: 4px 12px; border-radius: 6px; font-size: 20px;">
                            <span id="robot2State">ÂæÖÊ©ü‰∏≠</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="preset-selector">
                <label for="presetSelect" style="font-size: 20px;">„ÇØ„Ç§„ÉÉ„ÇØË®≠ÂÆö</label>
                <div style="display: flex; align-items: center; gap: 15px; justify-content: center; margin-top: 10px;">
                    <select id="presetSelect">
                        <option value="two-robots">2Âè∞„ÅßÂÖ®Èù¢ÂèéÁ©´</option>
                        <option value="left-robot-only">„Åç„Å§„Å≠Âè∑„ÅßÂÖ®Èù¢ÂèéÁ©´</option>
                        <option value="right-robot-only">„Åü„Å¨„ÅçÂè∑„ÅßÂÖ®Èù¢ÂèéÁ©´</option>
                        <option value="custom1">„Ç´„Çπ„Çø„É†ÂèéÁ©´1</option>
                        <option value="custom2">„Ç´„Çπ„Çø„É†ÂèéÁ©´2</option>
                    </select>
                    <button onclick="calculatePaths()" style="background-color: #66bb6a; color: white; font-size: 20px; padding: 10px 20px;">ÁµåË∑ØÁ¢∫Ë™ç</button>
                    <button onclick="clearPath()" style="background-color: #66bb6a; color: white; font-size: 20px; padding: 10px 20px;">ÁµåË∑Ø„ÇØ„É™„Ç¢</button>
                    <button id="playBtn" onclick="startAnimation()" style="background-color: #999; color: white; border: none; font-size: 20px; padding: 10px 15px; margin-left: 10px;" disabled>‚ñ∂</button>
                    <button id="stopBtn" onclick="stopAnimation()" style="background-color: #999; color: white; border: none; font-size: 20px; padding: 10px 15px; margin-left: 5px;" disabled>‚èπ</button>
                </div>
            </div>
            
            <div class="accordion-toggle" onclick="toggleAccordion()">
                <strong style="font-size: 20px;">Ë©≥Á¥∞Ë®≠ÂÆö</strong>
                <span class="icon">‚ñº</span>
            </div>
            
            <div class="accordion-content" id="detailSettings">
                <div class="control-buttons" style="margin-bottom: 20px; text-align: center;">
                    <button id="editBtn" onclick="enableEditMode()" style="background-color: #81c784; color: white; font-size: 20px; padding: 10px 20px; margin: 0 5px;">Á∑®ÈõÜ</button>
                    <button id="applyBtn" onclick="applySettings()" style="background-color: #66bb6a; color: white; font-size: 20px; padding: 10px 20px; margin: 0 5px;">ÂèçÊò†</button>
                    <button id="clearBtn" onclick="clearToPreset()" style="background-color: #a5d6a7; color: white; font-size: 20px; padding: 10px 20px; margin: 0 5px;">„ÇØ„É™„Ç¢</button>
                </div>
                <div class="controls">
                <div class="robot-controls">
                    <h3 style="font-size: 20px;"><span style="display: inline-block; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 10px solid #FF6B6B; margin-right: 8px; vertical-align: middle;"></span>„Åç„Å§„Å≠Âè∑ Ë®≠ÂÆö</h3>
                    <div class="robot-row">
                        <div class="control-group">
                            <label for="startArea1">ÈñãÂßã„Ç®„É™„Ç¢:</label>
                            <select id="startArea1" disabled>
                                <option value="1">„Ç®„É™„Ç¢1</option>
                                <option value="2">„Ç®„É™„Ç¢2</option>
                                <option value="3">„Ç®„É™„Ç¢3</option>
                                <option value="4">„Ç®„É™„Ç¢4</option>
                                <option value="5">„Ç®„É™„Ç¢5</option>
                                <option value="6">„Ç®„É™„Ç¢6</option>
                                <option value="7">„Ç®„É™„Ç¢7</option>
                                <option value="8">„Ç®„É™„Ç¢8</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label for="startLane1">ÈñãÂßãÈÄöË∑Ø:</label>
                            <select id="startLane1" disabled>
                                <option value="1">ÈÄöË∑Ø1</option>
                                <option value="2">ÈÄöË∑Ø2</option>
                                <option value="3">ÈÄöË∑Ø3</option>
                                <option value="4">ÈÄöË∑Ø4</option>
                                <option value="5">ÈÄöË∑Ø5</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label for="endArea1">ÁµÇ‰∫Ü„Ç®„É™„Ç¢:</label>
                            <select id="endArea1" disabled>
                                <option value="1">„Ç®„É™„Ç¢1</option>
                                <option value="2">„Ç®„É™„Ç¢2</option>
                                <option value="3">„Ç®„É™„Ç¢3</option>
                                <option value="4">„Ç®„É™„Ç¢4</option>
                                <option value="5" selected>„Ç®„É™„Ç¢5</option>
                                <option value="6">„Ç®„É™„Ç¢6</option>
                                <option value="7">„Ç®„É™„Ç¢7</option>
                                <option value="8">„Ç®„É™„Ç¢8</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label for="endLane1">ÁµÇ‰∫ÜÈÄöË∑Ø:</label>
                            <select id="endLane1" disabled>
                                <option value="1" selected>ÈÄöË∑Ø1</option>
                                <option value="2">ÈÄöË∑Ø2</option>
                                <option value="3">ÈÄöË∑Ø3</option>
                                <option value="4">ÈÄöË∑Ø4</option>
                                <option value="5">ÈÄöË∑Ø5</option>
                            </select>
                        </div>
                        
                        
                        <div class="control-group">
                            <label for="harvest1">ÂèéÁ©´Èáè(kg):</label>
                            <input type="text" id="harvest1" value="40" disabled 
                                   style="width: 80px; padding: 8px 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 20px;"
                                   pattern="[0-9]+(\.[0-9]+)?" inputmode="decimal">
                        </div>
                        
                        <div class="control-group">
                            <label for="ripeness1">ÂÆåÁÜüÂ∫¶(%):</label>
                            <input type="text" id="ripeness1" value="95" disabled 
                                   style="width: 60px; padding: 8px 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 20px;"
                                   pattern="[0-9]+(\.[0-9]+)?" inputmode="decimal">
                        </div>
                    </div>
                </div>

                <div class="robot-controls">
                    <h3 style="font-size: 20px;"><span style="display: inline-block; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 10px solid #4A90E2; margin-right: 8px; vertical-align: middle;"></span>„Åü„Å¨„ÅçÂè∑ Ë®≠ÂÆö</h3>
                    <div class="robot-row">
                        <div class="control-group">
                            <label for="startArea2">ÈñãÂßã„Ç®„É™„Ç¢:</label>
                            <select id="startArea2" disabled>
                                <option value="1">„Ç®„É™„Ç¢1</option>
                                <option value="2">„Ç®„É™„Ç¢2</option>
                                <option value="3">„Ç®„É™„Ç¢3</option>
                                <option value="4">„Ç®„É™„Ç¢4</option>
                                <option value="5">„Ç®„É™„Ç¢5</option>
                                <option value="6">„Ç®„É™„Ç¢6</option>
                                <option value="7">„Ç®„É™„Ç¢7</option>
                                <option value="8" selected>„Ç®„É™„Ç¢8</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label for="startLane2">ÈñãÂßãÈÄöË∑Ø:</label>
                            <select id="startLane2" disabled>
                                <option value="1">ÈÄöË∑Ø1</option>
                                <option value="2">ÈÄöË∑Ø2</option>
                                <option value="3">ÈÄöË∑Ø3</option>
                                <option value="4">ÈÄöË∑Ø4</option>
                                <option value="5" selected>ÈÄöË∑Ø5</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label for="endArea2">ÁµÇ‰∫Ü„Ç®„É™„Ç¢:</label>
                            <select id="endArea2" disabled>
                                <option value="1">„Ç®„É™„Ç¢1</option>
                                <option value="2">„Ç®„É™„Ç¢2</option>
                                <option value="3">„Ç®„É™„Ç¢3</option>
                                <option value="4" selected>„Ç®„É™„Ç¢4</option>
                                <option value="5">„Ç®„É™„Ç¢5</option>
                                <option value="6">„Ç®„É™„Ç¢6</option>
                                <option value="7">„Ç®„É™„Ç¢7</option>
                                <option value="8">„Ç®„É™„Ç¢8</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label for="endLane2">ÁµÇ‰∫ÜÈÄöË∑Ø:</label>
                            <select id="endLane2" disabled>
                                <option value="1">ÈÄöË∑Ø1</option>
                                <option value="2">ÈÄöË∑Ø2</option>
                                <option value="3">ÈÄöË∑Ø3</option>
                                <option value="4">ÈÄöË∑Ø4</option>
                                <option value="5" selected>ÈÄöË∑Ø5</option>
                            </select>
                        </div>
                        
                        
                        <div class="control-group">
                            <label for="harvest2">ÂèéÁ©´Èáè(kg):</label>
                            <input type="text" id="harvest2" value="40" disabled 
                                   style="width: 80px; padding: 8px 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 20px;"
                                   pattern="[0-9]+(\.[0-9]+)?" inputmode="decimal">
                        </div>
                        
                        <div class="control-group">
                            <label for="ripeness2">ÂÆåÁÜüÂ∫¶(%):</label>
                            <input type="text" id="ripeness2" value="95" disabled 
                                   style="width: 60px; padding: 8px 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 20px;"
                                   pattern="[0-9]+(\.[0-9]+)?" inputmode="decimal">
                        </div>
                    </div>
                </div>


                </div>
            </div>
            
            <div class="quick-controls">
                <div class="control-buttons">
                    <button onclick="sendSettings()" style="background-color: #66bb6a; font-size: 18px; padding: 10px 25px;">ÂêÑ„É≠„Éú„ÉÉ„Éà„Å´ÈÄÅ‰ø°</button>
                </div>
            </div>
            
            <div class="accordion-toggle" onclick="toggleLogAccordion()" style="margin-top: 20px;">
                <strong style="font-size: 20px;">ÈÅéÂéª„ÅÆÂèéÁ©´Ë®òÈå≤</strong>
                <span class="icon" id="logIcon">‚ñº</span>
            </div>
            
            <div class="accordion-content" id="logContent">
                <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); max-height: 400px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 16px;">
                        <thead>
                            <tr style="background: #e8f5e9; border-bottom: 2px solid #81c784;">
                                <th style="padding: 10px; text-align: left;">ÂèéÁ©´Êó•</th>
                                <th style="padding: 10px; text-align: left;">ÈñãÂßãÊôÇÂàª</th>
                                <th style="padding: 10px; text-align: left;">ÁµÇ‰∫ÜÊôÇÂàª</th>
                                <th style="padding: 10px; text-align: right;">ÂÆüÈöõ„ÅÆÂèéÁ©´Èáè(kg)</th>
                                <th style="padding: 10px; text-align: center;">Ë©≥Á¥∞</th>
                            </tr>
                        </thead>
                        <tbody id="logTableBody">
                            <!-- „Çµ„É≥„Éó„É´„Éá„Éº„Çø -->
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <td style="padding: 10px;">2024/12/20</td>
                                <td style="padding: 10px;">08:30</td>
                                <td style="padding: 10px;">11:45</td>
                                <td style="padding: 10px; text-align: right;">85.5</td>
                                <td style="padding: 10px; text-align: center;">
                                    <button onclick="showLogDetail(1)" style="background-color: #a5d6a7; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">Ë©≥Á¥∞</button>
                                </td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <td style="padding: 10px;">2024/12/19</td>
                                <td style="padding: 10px;">09:00</td>
                                <td style="padding: 10px;">12:30</td>
                                <td style="padding: 10px; text-align: right;">92.3</td>
                                <td style="padding: 10px; text-align: center;">
                                    <button onclick="showLogDetail(2)" style="background-color: #a5d6a7; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">Ë©≥Á¥∞</button>
                                </td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <td style="padding: 10px;">2024/12/18</td>
                                <td style="padding: 10px;">08:00</td>
                                <td style="padding: 10px;">10:45</td>
                                <td style="padding: 10px; text-align: right;">78.8</td>
                                <td style="padding: 10px; text-align: center;">
                                    <button onclick="showLogDetail(3)" style="background-color: #a5d6a7; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">Ë©≥Á¥∞</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´ -->
            <div id="logDetailModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; max-width: 600px; width: 90%; max-height: 80%; overflow-y: auto;">
                    <h3 style="margin-bottom: 20px; color: #4caf50;">ÂèéÁ©´Ë©≥Á¥∞ÊÉÖÂ†±</h3>
                    <div id="logDetailContent"></div>
                </div>
            </div>
            
            <!-- „Éû„Éã„É•„Ç¢„É´„É¢„Éº„ÉÄ„É´ -->
            <div id="manualModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1001;">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 40px; border-radius: 15px; max-width: 800px; width: 90%; max-height: 85%; overflow-y: auto; box-shadow: 0 5px 20px rgba(0,0,0,0.3);">
                    <h2 style="margin-bottom: 30px; color: #4caf50; text-align: center; border-bottom: 3px solid #4caf50; padding-bottom: 15px;">ÂèéÁ©´„É≠„Éú„ÉÉ„ÉàÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† „Éû„Éã„É•„Ç¢„É´</h2>
                    
                    <div id="manualContent">
                        <!-- „Éû„Éã„É•„Ç¢„É´ÂÜÖÂÆπ„ÅØ manual.html „Åã„ÇâË™≠„ÅøËæº„Åæ„Çå„Åæ„Åô -->
                    </div>
                </div>
            </div>
            
            <!-- ÈÄÅ‰ø°ÁµêÊûú„É¢„Éº„ÉÄ„É´ -->
            <div id="sendResultModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1002;">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; max-width: 700px; width: 90%; max-height: 80%; overflow-y: auto; box-shadow: 0 5px 20px rgba(0,0,0,0.3);">
                    <h2 style="margin-bottom: 25px; color: #4caf50; text-align: center;">ÈÄÅ‰ø°ÁµêÊûú</h2>
                    
                    <div id="sendResultContent"></div>
                </div>
            </div>
            
        </div>

        <div class="map-panel">
            <canvas id="canvas"></canvas>
        </div>
    </div>

    <script>
        // ÁèæÂú®„ÅÆÊó•ÊôÇ„ÇíË°®Á§∫
        function updateDateTime() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('ja-JP', { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit' 
            });
            const timeStr = now.toLocaleTimeString('ja-JP', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            document.getElementById('current-date').textContent = `${dateStr} ${timeStr}`;
        }

        updateDateTime();
        setInterval(updateDateTime, 60000); // 1ÂàÜ„Åî„Å®„Å´Êõ¥Êñ∞
        
        // „É≠„Éú„ÉÉ„ÉàÁä∂ÊÖã„ÅÆÊõ¥Êñ∞
        function updateRobotStatus(robotId, status) {
            const statusElement = document.getElementById(`robot${robotId}State`);
            const statusItem = document.getElementById(`robot${robotId}Status`);
            
            // Áä∂ÊÖã„Å´Âøú„Åò„Åü„Ç¢„Ç§„Ç≥„É≥„ÇíË®≠ÂÆö
            let icon = '';
            switch(status) {
                case 'ÂÖÖÈõª‰∏≠':
                    icon = 'üîã ';
                    break;
                case 'ÂæÖÊ©ü‰∏≠':
                    icon = '‚è∏Ô∏è ';
                    break;
                case 'Á®ºÂÉç‰∏≠':
                    icon = 'üöú ';
                    break;
                case 'ÈÄö‰ø°‰∏çÂèØ':
                    icon = 'üìµ ';
                    break;
                default:
                    icon = '';
            }
            
            statusElement.textContent = icon + status;
        }
        
        // ÂàùÊúüÁä∂ÊÖã„ÇíË®≠ÂÆö
        updateRobotStatus(1, 'ÂÖÖÈõª‰∏≠');
        updateRobotStatus(2, 'ÂæÖÊ©ü‰∏≠');
        
        // „Éá„É¢Áî®: „É≠„Éú„ÉÉ„ÉàÁä∂ÊÖã„ÇíÂÆöÊúüÁöÑ„Å´Êõ¥Êñ∞
        setInterval(function() {
            const states = ['ÂÖÖÈõª‰∏≠', 'ÂæÖÊ©ü‰∏≠', 'Á®ºÂÉç‰∏≠', 'ÈÄö‰ø°‰∏çÂèØ'];
            const randomState1 = states[Math.floor(Math.random() * states.length)];
            const randomState2 = states[Math.floor(Math.random() * states.length)];
            // updateRobotStatus(1, randomState1);
            // updateRobotStatus(2, randomState2);
        }, 5000); // 5Áßí„Åî„Å®„Å´Êõ¥Êñ∞Ôºà„Éá„É¢Áî®„ÄÅÂÆüÈöõ„ÅØ„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„ÉàÔºâ

        // ÁµåË∑Ø„Çí‰øùÂ≠ò„Åô„ÇãÈÖçÂàó
        let currentPaths = [];
        
        // „É≠„Éú„ÉÉ„ÉàË®≠ÂÆö„ÅÆÂü∫Êú¨Èñ¢Êï∞
        function calculatePaths() {
            console.log('ÁµåË∑ØË®àÁÆó„ÇíÂÆüË°å');
            
            // ÁèæÂú®„ÅÆ„Éó„É™„Çª„ÉÉ„Éà„ÇíÂèñÂæó
            const presetSelect = document.getElementById('presetSelect');
            const selectedPreset = presetSelect.value;
            
            // ÁµåË∑Ø„Çí„ÇØ„É™„Ç¢
            currentPaths = [];
            
            if (selectedPreset === 'left-robot-only') {
                // „Åç„Å§„Å≠Âè∑„ÅßÂÖ®Èù¢ÂèéÁ©´„ÅÆÁµåË∑Ø„ÇíË®àÁÆó
                calculateKitsunePath();
            } else if (selectedPreset === 'right-robot-only') {
                // „Åü„Å¨„ÅçÂè∑„ÅßÂÖ®Èù¢ÂèéÁ©´„ÅÆÁµåË∑Ø„ÇíË®àÁÆó
                calculateTanukiPath();
            } else if (selectedPreset === 'two-robots') {
                // ÔºíÂè∞„ÅßÂÖ®Èù¢ÂèéÁ©´„ÅÆÁµåË∑Ø„ÇíË®àÁÆó
                calculateDualRobotPath();
            }
            // ‰ªñ„ÅÆ„Éó„É™„Çª„ÉÉ„Éà„ÅÆÁµåË∑ØË®àÁÆó„ÅØÂøÖË¶Å„Å´Âøú„Åò„Å¶ËøΩÂä†
            
            // ÁµåË∑Ø„ÇíÊèèÁîª
            drawFarm();
            
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Éú„Çø„É≥„ÇíÊúâÂäπÂåñ
            updateAnimationButtons();
        }

        function clearPath() {
            console.log('ÁµåË∑Ø„Çí„ÇØ„É™„Ç¢');
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíÂÅúÊ≠¢
            if (isAnimating) {
                stopAnimation();
            }
            // ÁµåË∑Ø„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢
            currentPaths = [];
            // „É≠„Éú„ÉÉ„Éà„ÇíÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥„Å´Êàª„Åô
            robotPositions.robot1 = { x: leftMargin - 60, y: topBottomMargin + farmHeight / 2 - 15, angle: 0 };
            robotPositions.robot2 = { x: leftMargin - 30, y: topBottomMargin + farmHeight / 2 + 15, angle: 0 };
            // „Ç≠„É£„É≥„Éê„Çπ„ÇíÂÜçÊèèÁîª
            drawFarm();
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ
            updateAnimationButtons();
        }
        
        // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
        function updateAnimationButtons() {
            const hasPath = Array.isArray(currentPaths) ? currentPaths.length > 0 : 
                           (currentPaths.kitsune && currentPaths.tanuki);
            const playBtn = document.getElementById('playBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            if (hasPath && !isAnimating) {
                playBtn.disabled = false;
                stopBtn.disabled = true;
            } else if (!hasPath) {
                playBtn.disabled = true;
                stopBtn.disabled = true;
            }
        }
        
        // „Åç„Å§„Å≠Âè∑„ÅÆÂÖ®Èù¢ÂèéÁ©´ÁµåË∑Ø„ÇíË®àÁÆó
        function calculateKitsunePath() {
            // „Ç®„É™„Ç¢„ÅÆÈ†ÜÁï™: 1,2,3,4,8,7,6,5
            const areaOrder = [1, 2, 3, 4, 8, 7, 6, 5];
            
            currentPaths = [];
            
            // „Åç„Å§„Å≠Âè∑„ÅÆÂàùÊúü‰ΩçÁΩÆ„Çí„Ç®„É™„Ç¢1ÈÄöË∑Ø2„Å´Ë®≠ÂÆö
            const initialLaneX = leftMargin + 0 * areaWidth + (2 - 0.5) * (areaWidth / 5);
            const centralY = topBottomMargin + farmHeight / 2;
            updateRobotPosition(1, initialLaneX, centralY - centralPathWidth/2, 270); // ÂåóÂêë„Åç
            
            areaOrder.forEach(areaNum => {
                const areaIndex = areaNum - 1;
                const row = areaIndex < 4 ? 0 : 1;
                const col = areaIndex % 4;
                
                // ÂåóÂÅ¥„Ç®„É™„Ç¢Ôºà1-4Ôºâ„ÅØÈÄöË∑Ø2,3,4,5„ÄÅÂçóÂÅ¥„Ç®„É™„Ç¢Ôºà5-8Ôºâ„ÅØÈÄöË∑Ø4,3,2,1„Çí‰ΩøÁî®
                let lanes;
                if (row === 0) {
                    // ÂåóÂÅ¥: ÈÄöË∑Ø1„Çí„Çπ„Ç≠„ÉÉ„Éó
                    lanes = [2, 3, 4, 5];
                } else {
                    // ÂçóÂÅ¥: ÈÄöË∑Ø5„Çí„Çπ„Ç≠„ÉÉ„Éó
                    lanes = [4, 3, 2, 1];
                }
                
                lanes.forEach((laneNum, laneIndex) => {
                    // ÈÄöË∑Ø„ÅÆ‰ΩçÁΩÆ„ÇíË®àÁÆó
                    const laneWidth = areaWidth / 5;
                    const laneX = leftMargin + col * areaWidth + (laneNum - 0.5) * laneWidth;
                    
                    // ÈñãÂßãÁÇπÔºà‰∏≠Â§ÆÈÄöË∑Ø„ÅÆÁúü„Çì‰∏≠Ôºâ
                    const startY = topBottomMargin + farmHeight / 2;
                    
                    // ÁµÇ‰∫ÜÁÇπÔºà„Ç®„É™„Ç¢„ÅÆÁ´Ø„Åæ„ÅßÔºâ
                    let endY;
                    if (row === 0) {
                        // ÂåóÂÅ¥„Ç®„É™„Ç¢ - ‰∏äÁ´Ø„Åæ„Åß
                        endY = topBottomMargin + pathWidth;
                    } else {
                        // ÂçóÂÅ¥„Ç®„É™„Ç¢ - ‰∏ãÁ´Ø„Åæ„Åß
                        endY = topBottomMargin + farmHeight - pathWidth;
                    }
                    
                    // ÂâçÈÄ≤„Éë„ÇπÔºà‰∏≠Â§ÆÈÄöË∑Ø„Åã„ÇâÁ´Ø„Å∏Ôºâ
                    currentPaths.push({
                        type: 'forward',
                        startX: laneX,
                        startY: startY,
                        endX: laneX,
                        endY: endY,
                        area: areaNum,
                        lane: laneNum
                    });
                    
                    // „Éê„ÉÉ„ÇØ„Éë„ÇπÔºàÁ´Ø„Åã„Çâ‰∏≠Â§ÆÈÄöË∑Ø„Å∏Ôºâ
                    currentPaths.push({
                        type: 'backward',
                        startX: laneX,
                        startY: endY,
                        endX: laneX,
                        endY: startY,
                        area: areaNum,
                        lane: laneNum
                    });
                    
                    // Ê¨°„ÅÆÈÄöË∑Ø„Å∏„ÅÆÁßªÂãïÔºà‰∏≠Â§ÆÈÄöË∑Ø„ÇíÈÄö„Å£„Å¶Ôºâ
                    if (laneIndex < lanes.length - 1) {
                        const nextLaneX = leftMargin + col * areaWidth + (lanes[laneIndex + 1] - 0.5) * laneWidth;
                        currentPaths.push({
                            type: 'transit',
                            startX: laneX,
                            startY: startY,
                            endX: nextLaneX,
                            endY: startY,
                            area: areaNum
                        });
                    }
                });
                
                // Ê¨°„ÅÆ„Ç®„É™„Ç¢„Å∏„ÅÆÁßªÂãïÔºà‰∏≠Â§ÆÈÄöË∑Ø„ÇíÈÄö„Å£„Å¶Ôºâ
                if (areaOrder.indexOf(areaNum) < areaOrder.length - 1) {
                    const nextAreaNum = areaOrder[areaOrder.indexOf(areaNum) + 1];
                    const nextAreaIndex = nextAreaNum - 1;
                    const nextRow = nextAreaIndex < 4 ? 0 : 1;
                    const nextCol = nextAreaIndex % 4;
                    
                    // ÁèæÂú®„ÅÆ„Ç®„É™„Ç¢„ÅÆÊúÄÂæå„ÅÆÈÄöË∑Ø
                    const currentLastLane = row === 0 ? 5 : 1;
                    const currentLastLaneX = leftMargin + col * areaWidth + (currentLastLane - 0.5) * (areaWidth / 5);
                    
                    // Ê¨°„ÅÆ„Ç®„É™„Ç¢„ÅÆÊúÄÂàù„ÅÆÈÄöË∑Ø
                    const nextFirstLane = nextRow === 0 ? 2 : 4;
                    const nextFirstLaneX = leftMargin + nextCol * areaWidth + (nextFirstLane - 0.5) * (areaWidth / 5);
                    
                    const currentY = topBottomMargin + farmHeight / 2;
                    
                    currentPaths.push({
                        type: 'transit',
                        startX: currentLastLaneX,
                        startY: currentY,
                        endX: nextFirstLaneX,
                        endY: currentY,
                        area: areaNum,
                        nextArea: nextAreaNum
                    });
                }
            });
        }
        
        // „Åü„Å¨„ÅçÂè∑„ÅÆÂÖ®Èù¢ÂèéÁ©´ÁµåË∑Ø„ÇíË®àÁÆó
        function calculateTanukiPath() {
            // „Ç®„É™„Ç¢„ÅÆÈ†ÜÁï™: 8,7,6,5,1,2,3,4
            const areaOrder = [8, 7, 6, 5, 1, 2, 3, 4];
            
            currentPaths = [];
            
            // „Åü„Å¨„ÅçÂè∑„ÅÆÂàùÊúü‰ΩçÁΩÆ„Çí„Ç®„É™„Ç¢8ÈÄöË∑Ø5„Å´Ë®≠ÂÆö
            const initialLaneX = leftMargin + 3 * areaWidth + (5 - 0.5) * (areaWidth / 5);
            const centralY = topBottomMargin + farmHeight / 2;
            updateRobotPosition(2, initialLaneX, centralY + centralPathWidth/2, 90); // ÂçóÂêë„Åç
            
            areaOrder.forEach(areaNum => {
                const areaIndex = areaNum - 1;
                const row = areaIndex < 4 ? 0 : 1;
                const col = areaIndex % 4;
                
                // ÂçóÂÅ¥„Ç®„É™„Ç¢Ôºà5-8Ôºâ„ÅØÈÄöË∑Ø5,4,3,2„ÄÅÂåóÂÅ¥„Ç®„É™„Ç¢Ôºà1-4Ôºâ„ÅØÈÄöË∑Ø1,2,3,4„Çí‰ΩøÁî®
                let lanes;
                if (row === 1) {
                    // ÂçóÂÅ¥: ÈÄöË∑Ø1„Çí„Çπ„Ç≠„ÉÉ„Éó
                    lanes = [5, 4, 3, 2];
                } else {
                    // ÂåóÂÅ¥: ÈÄöË∑Ø5„Çí„Çπ„Ç≠„ÉÉ„Éó
                    lanes = [1, 2, 3, 4];
                }
                
                lanes.forEach((laneNum, laneIndex) => {
                    // ÈÄöË∑Ø„ÅÆ‰ΩçÁΩÆ„ÇíË®àÁÆó
                    const laneWidth = areaWidth / 5;
                    const laneX = leftMargin + col * areaWidth + (laneNum - 0.5) * laneWidth;
                    
                    // ÈñãÂßãÁÇπÔºà‰∏≠Â§ÆÈÄöË∑Ø„ÅÆÁúü„Çì‰∏≠Ôºâ
                    const startY = topBottomMargin + farmHeight / 2;
                    
                    // ÁµÇ‰∫ÜÁÇπÔºà„Ç®„É™„Ç¢„ÅÆÁ´Ø„Åæ„ÅßÔºâ
                    let endY;
                    if (row === 0) {
                        // ÂåóÂÅ¥„Ç®„É™„Ç¢ - ‰∏äÁ´Ø„Åæ„Åß
                        endY = topBottomMargin + pathWidth;
                    } else {
                        // ÂçóÂÅ¥„Ç®„É™„Ç¢ - ‰∏ãÁ´Ø„Åæ„Åß
                        endY = topBottomMargin + farmHeight - pathWidth;
                    }
                    
                    // ÂâçÈÄ≤„Éë„ÇπÔºà‰∏≠Â§ÆÈÄöË∑Ø„Åã„ÇâÁ´Ø„Å∏Ôºâ
                    currentPaths.push({
                        type: 'forward',
                        startX: laneX,
                        startY: startY,
                        endX: laneX,
                        endY: endY,
                        area: areaNum,
                        lane: laneNum
                    });
                    
                    // „Éê„ÉÉ„ÇØ„Éë„ÇπÔºàÁ´Ø„Åã„Çâ‰∏≠Â§ÆÈÄöË∑Ø„Å∏Ôºâ
                    currentPaths.push({
                        type: 'backward',
                        startX: laneX,
                        startY: endY,
                        endX: laneX,
                        endY: startY,
                        area: areaNum,
                        lane: laneNum
                    });
                    
                    // Ê¨°„ÅÆÈÄöË∑Ø„Å∏„ÅÆÁßªÂãïÔºà‰∏≠Â§ÆÈÄöË∑Ø„ÇíÈÄö„Å£„Å¶Ôºâ
                    if (laneIndex < lanes.length - 1) {
                        const nextLaneX = leftMargin + col * areaWidth + (lanes[laneIndex + 1] - 0.5) * laneWidth;
                        currentPaths.push({
                            type: 'transit',
                            startX: laneX,
                            startY: startY,
                            endX: nextLaneX,
                            endY: startY,
                            area: areaNum
                        });
                    }
                });
                
                // Ê¨°„ÅÆ„Ç®„É™„Ç¢„Å∏„ÅÆÁßªÂãïÔºà‰∏≠Â§ÆÈÄöË∑Ø„ÇíÈÄö„Å£„Å¶Ôºâ
                if (areaOrder.indexOf(areaNum) < areaOrder.length - 1) {
                    const nextAreaNum = areaOrder[areaOrder.indexOf(areaNum) + 1];
                    const nextAreaIndex = nextAreaNum - 1;
                    const nextRow = nextAreaIndex < 4 ? 0 : 1;
                    const nextCol = nextAreaIndex % 4;
                    
                    // ÁèæÂú®„ÅÆ„Ç®„É™„Ç¢„ÅÆÊúÄÂæå„ÅÆÈÄöË∑Ø
                    const currentLastLane = row === 1 ? 2 : 4;
                    const currentLastLaneX = leftMargin + col * areaWidth + (currentLastLane - 0.5) * (areaWidth / 5);
                    
                    // Ê¨°„ÅÆ„Ç®„É™„Ç¢„ÅÆÊúÄÂàù„ÅÆÈÄöË∑Ø
                    const nextFirstLane = nextRow === 1 ? 5 : 1;
                    const nextFirstLaneX = leftMargin + nextCol * areaWidth + (nextFirstLane - 0.5) * (areaWidth / 5);
                    
                    const currentY = topBottomMargin + farmHeight / 2;
                    
                    currentPaths.push({
                        type: 'transit',
                        startX: currentLastLaneX,
                        startY: currentY,
                        endX: nextFirstLaneX,
                        endY: currentY,
                        area: areaNum,
                        nextArea: nextAreaNum
                    });
                }
            });
        }
        
        // ÔºíÂè∞„ÅßÂÖ®Èù¢ÂèéÁ©´„ÅÆÁµåË∑Ø„ÇíË®àÁÆó
        function calculateDualRobotPath() {
            // „Åç„Å§„Å≠Âè∑„Å®„Åü„Å¨„ÅçÂè∑„ÅÆÁµåË∑Ø„Çí‰∏°ÊñπË®àÁÆó
            calculateKitsunePath();
            const kitsunePaths = [...currentPaths];
            
            calculateTanukiPath();
            const tanukiPaths = [...currentPaths];
            
            // ‰∏°Êñπ„ÅÆÁµåË∑Ø„ÇíÁµêÂêà„Åó„Å¶‰øùÂ≠ò
            currentPaths = {
                kitsune: kitsunePaths,
                tanuki: tanukiPaths
            };
        }

        // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Èñ¢ÈÄ£„ÅÆÂ§âÊï∞
        let animationId = null;
        let currentPathIndex = 0;
        let animationProgress = 0;
        let isAnimating = false;
        
        // ÔºíÂè∞„É¢„Éº„ÉâÁî®„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Â§âÊï∞
        let currentPathIndexKitsune = 0;
        let currentPathIndexTanuki = 0;
        let animationProgressKitsune = 0;
        let animationProgressTanuki = 0;
        
        // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰∏≠„ÅÆÂ¢ÉÁïåÁ∑öÁÆ°ÁêÜ
        let showStaticBoundaries = true; // ÈùôÁöÑ„Å™Â¢ÉÁïåÁ∑öË°®Á§∫„Éï„É©„Ç∞
        let drawnBoundariesKitsune = new Set(); // „Åç„Å§„Å≠Âè∑„ÅåÈÄöÈÅé„Åó„ÅüÂ¢ÉÁïåÁ∑ö
        let drawnBoundariesTanuki = new Set(); // „Åü„Å¨„ÅçÂè∑„ÅåÈÄöÈÅé„Åó„ÅüÂ¢ÉÁïåÁ∑ö

        function startAnimation() {
            const hasPath = Array.isArray(currentPaths) ? currentPaths.length > 0 : 
                           (currentPaths.kitsune && currentPaths.tanuki);
            if (!hasPath) return;
            
            console.log('„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈñãÂßã');
            isAnimating = true;
            currentPathIndex = 0;
            animationProgress = 0;
            
            // ÔºíÂè∞„É¢„Éº„ÉâÁî®„ÅÆÂ§âÊï∞„Çí„É™„Çª„ÉÉ„Éà
            currentPathIndexKitsune = 0;
            currentPathIndexTanuki = 0;
            animationProgressKitsune = 0;
            animationProgressTanuki = 0;
            
            // Â¢ÉÁïåÁ∑öË°®Á§∫„Çí„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà
            showStaticBoundaries = false;
            drawnBoundariesKitsune.clear();
            drawnBoundariesTanuki.clear();
            
            // „Éú„Çø„É≥Áä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.getElementById('playBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„É´„Éº„Éó„ÇíÈñãÂßã
            animate();
        }

        function stopAnimation() {
            console.log('„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÅúÊ≠¢');
            isAnimating = false;
            
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            // „É≠„Éú„ÉÉ„Éà„ÇíÂàùÊúü‰ΩçÁΩÆ„Å´Êàª„Åô
            if (currentPaths.length > 0) {
                // „Éó„É™„Çª„ÉÉ„Éà„Å´Âøú„Åò„Å¶ÂàùÊúü‰ΩçÁΩÆ„ÇíÊ±∫ÂÆö
                const presetSelect = document.getElementById('presetSelect');
                const selectedPreset = presetSelect.value;
                
                if (selectedPreset === 'left-robot-only') {
                    // „Åç„Å§„Å≠Âè∑„ÅÆÂàùÊúü‰ΩçÁΩÆ
                    const initialLaneX = leftMargin + 0 * areaWidth + (2 - 0.5) * (areaWidth / 5);
                    const centralY = topBottomMargin + farmHeight / 2;
                    updateRobotPosition(1, initialLaneX, centralY - centralPathWidth/2, 270);
                } else if (selectedPreset === 'right-robot-only') {
                    // „Åü„Å¨„ÅçÂè∑„ÅÆÂàùÊúü‰ΩçÁΩÆ
                    const initialLaneX = leftMargin + 3 * areaWidth + (5 - 0.5) * (areaWidth / 5);
                    const centralY = topBottomMargin + farmHeight / 2;
                    updateRobotPosition(2, initialLaneX, centralY + centralPathWidth/2, 90);
                }
            }
            
            // Â¢ÉÁïåÁ∑öË°®Á§∫„ÇíÈùôÁöÑ„É¢„Éº„Éâ„Å´Êàª„Åô
            showStaticBoundaries = true;
            
            // „Éú„Çø„É≥Áä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.getElementById('playBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }

        function animate() {
            const presetSelect = document.getElementById('presetSelect');
            const selectedPreset = presetSelect.value;
            
            if (selectedPreset === 'two-robots') {
                // ÔºíÂè∞„É¢„Éº„Éâ„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                if (!isAnimating || !currentPaths.kitsune || !currentPaths.tanuki) return;
                
                const speed = 6; // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈÄüÂ∫¶Ôºà2ÂÄçÈÄüÔºâ
                let bothCompleted = true;
                
                // „Åç„Å§„Å≠Âè∑„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                if (currentPathIndexKitsune < currentPaths.kitsune.length) {
                    bothCompleted = false;
                    const currentPath = currentPaths.kitsune[currentPathIndexKitsune];
                    
                    const startX = currentPath.startX;
                    const startY = currentPath.startY;
                    const endX = currentPath.endX;
                    const endY = currentPath.endY;
                    
                    const x = startX + (endX - startX) * animationProgressKitsune;
                    const y = startY + (endY - startY) * animationProgressKitsune;
                    
                    // „Ç®„É™„Ç¢„ÅÆ‰ΩçÁΩÆ„ÇíÂà§ÂÆö
                    const areaNum = currentPath.area;
                    const isNorthArea = areaNum <= 4;
                    const angle = isNorthArea ? 270 : 90;
                    
                    updateRobotPosition(1, x, y, angle); // „Åç„Å§„Å≠Âè∑
                    
                    // „É≠„Éú„ÉÉ„Éà„ÅåÈÄöË∑Ø„ÅÆÁ´Ø„Å´Âà∞ÈÅî„Åó„ÅüÊôÇ„Å´Â¢ÉÁïåÁ∑ö„ÇíËøΩÂä†
                    if (currentPath.type === 'forward' && animationProgressKitsune > 0.9) {
                        const boundaryKey = `${currentPath.area}-${currentPath.lane}`;
                        drawnBoundariesKitsune.add(boundaryKey);
                    }
                    
                    animationProgressKitsune += speed / 100;
                    
                    if (animationProgressKitsune >= 1) {
                        currentPathIndexKitsune++;
                        animationProgressKitsune = 0;
                    }
                }
                
                // „Åü„Å¨„ÅçÂè∑„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                if (currentPathIndexTanuki < currentPaths.tanuki.length) {
                    bothCompleted = false;
                    const currentPath = currentPaths.tanuki[currentPathIndexTanuki];
                    
                    const startX = currentPath.startX;
                    const startY = currentPath.startY;
                    const endX = currentPath.endX;
                    const endY = currentPath.endY;
                    
                    const x = startX + (endX - startX) * animationProgressTanuki;
                    const y = startY + (endY - startY) * animationProgressTanuki;
                    
                    // „Ç®„É™„Ç¢„ÅÆ‰ΩçÁΩÆ„ÇíÂà§ÂÆö
                    const areaNum = currentPath.area;
                    const isNorthArea = areaNum <= 4;
                    const angle = isNorthArea ? 270 : 90;
                    
                    updateRobotPosition(2, x, y, angle); // „Åü„Å¨„ÅçÂè∑
                    
                    // „É≠„Éú„ÉÉ„Éà„ÅåÈÄöË∑Ø„ÅÆÁ´Ø„Å´Âà∞ÈÅî„Åó„ÅüÊôÇ„Å´Â¢ÉÁïåÁ∑ö„ÇíËøΩÂä†
                    if (currentPath.type === 'forward' && animationProgressTanuki > 0.9) {
                        const boundaryKey = `${currentPath.area}-${currentPath.lane}`;
                        drawnBoundariesTanuki.add(boundaryKey);
                    }
                    
                    animationProgressTanuki += speed / 100;
                    
                    if (animationProgressTanuki >= 1) {
                        currentPathIndexTanuki++;
                        animationProgressTanuki = 0;
                    }
                }
                
                if (bothCompleted) {
                    stopAnimation();
                    return;
                }
                
                // Âú∞Âõ≥„ÇíÂÜçÊèèÁîª
                drawFarm();
                
                // Ê¨°„ÅÆ„Éï„É¨„Éº„É†„Çí„É™„ÇØ„Ç®„Çπ„Éà
                animationId = requestAnimationFrame(animate);
            } else {
                // Âçò‰Ωì„É≠„Éú„ÉÉ„Éà„É¢„Éº„Éâ„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                if (!isAnimating || !Array.isArray(currentPaths) || currentPaths.length === 0) return;
                
                const speed = 6; // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈÄüÂ∫¶Ôºà2ÂÄçÈÄüÔºâ
                
                if (currentPathIndex < currentPaths.length) {
                    const currentPath = currentPaths[currentPathIndex];
                    
                    // ÁèæÂú®„ÅÆ„Éë„Çπ„Åß„ÅÆ‰ΩçÁΩÆ„ÇíË®àÁÆó
                    const startX = currentPath.startX;
                    const startY = currentPath.startY;
                    const endX = currentPath.endX;
                    const endY = currentPath.endY;
                    
                    const x = startX + (endX - startX) * animationProgress;
                    const y = startY + (endY - startY) * animationProgress;
                    
                    // ÈÄ≤Ë°åÊñπÂêë„ÇíË®àÁÆó
                    let angle = 0;
                    
                    // „Ç®„É™„Ç¢„ÅÆ‰ΩçÁΩÆ„ÇíÂà§ÂÆö
                    const areaNum = currentPath.area;
                    const isNorthArea = areaNum <= 4;
                    
                    if (isNorthArea) {
                        angle = 270; // Âåó„Ç®„É™„Ç¢ÔºöÂåóÂêë„Åç
                    } else {
                        angle = 90; // Âçó„Ç®„É™„Ç¢ÔºöÂçóÂêë„Åç
                    }
                    
                    // „É≠„Éú„ÉÉ„Éà„ÅÆ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞Ôºà„Éó„É™„Çª„ÉÉ„Éà„Å´Âøú„Åò„Å¶Ôºâ
                    if (selectedPreset === 'left-robot-only') {
                        updateRobotPosition(1, x, y, angle); // „Åç„Å§„Å≠Âè∑
                        // „É≠„Éú„ÉÉ„Éà„ÅåÈÄöË∑Ø„ÅÆÁ´Ø„Å´Âà∞ÈÅî„Åó„ÅüÊôÇ„Å´Â¢ÉÁïåÁ∑ö„ÇíËøΩÂä†
                        if (currentPath.type === 'forward' && animationProgress > 0.9) {
                            const boundaryKey = `${currentPath.area}-${currentPath.lane}`;
                            drawnBoundariesKitsune.add(boundaryKey);
                        }
                    } else if (selectedPreset === 'right-robot-only') {
                        updateRobotPosition(2, x, y, angle); // „Åü„Å¨„ÅçÂè∑
                        // „É≠„Éú„ÉÉ„Éà„ÅåÈÄöË∑Ø„ÅÆÁ´Ø„Å´Âà∞ÈÅî„Åó„ÅüÊôÇ„Å´Â¢ÉÁïåÁ∑ö„ÇíËøΩÂä†
                        if (currentPath.type === 'forward' && animationProgress > 0.9) {
                            const boundaryKey = `${currentPath.area}-${currentPath.lane}`;
                            drawnBoundariesTanuki.add(boundaryKey);
                        }
                    }
                    
                    // ÈÄ≤Ë°åÁä∂Ê≥Å„ÇíÊõ¥Êñ∞
                    animationProgress += speed / 100;
                    
                    if (animationProgress >= 1) {
                        // Ê¨°„ÅÆ„Éë„Çπ„Å´ÁßªÂãï
                        currentPathIndex++;
                        animationProgress = 0;
                        
                        if (currentPathIndex >= currentPaths.length) {
                            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆå‰∫Ü
                            stopAnimation();
                            return;
                        }
                    }
                }
                
                // Âú∞Âõ≥„ÇíÂÜçÊèèÁîª
                drawFarm();
                
                // Ê¨°„ÅÆ„Éï„É¨„Éº„É†„Çí„É™„ÇØ„Ç®„Çπ„Éà
                animationId = requestAnimationFrame(animate);
            }
        }

        // „Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥„ÅÆÈñãÈñâ
        function toggleAccordion() {
            const toggle = document.querySelector('.accordion-toggle');
            const content = document.getElementById('detailSettings');
            
            toggle.classList.toggle('active');
            content.classList.toggle('active');
        }
        
        // „É≠„Ç∞„Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥„ÅÆÈñãÈñâ
        function toggleLogAccordion() {
            const toggle = event.currentTarget;
            const content = document.getElementById('logContent');
            const icon = document.getElementById('logIcon');
            
            toggle.classList.toggle('active');
            content.classList.toggle('active');
            
            // „Ç¢„Ç§„Ç≥„É≥„ÅÆÂõûËª¢
            if (content.classList.contains('active')) {
                icon.style.transform = 'rotate(180deg)';
            } else {
                icon.style.transform = 'rotate(0deg)';
            }
        }
        
        // „É≠„Ç∞Ë©≥Á¥∞Ë°®Á§∫
        function showLogDetail(logId) {
            const modal = document.getElementById('logDetailModal');
            const content = document.getElementById('logDetailContent');
            
            // „Çµ„É≥„Éó„É´Ë©≥Á¥∞„Éá„Éº„Çø
            const logDetails = {
                1: {
                    date: '2024/12/20',
                    startTime: '08:30',
                    endTime: '11:45',
                    totalHarvest: '85.5kg',
                    t7l: {
                        harvest: '40kg',
                        ripeness: '95%',
                        startArea: '„Ç®„É™„Ç¢1 ÈÄöË∑Ø1',
                        endArea: '„Ç®„É™„Ç¢5 ÈÄöË∑Ø1',
                    },
                    t7r: {
                        harvest: '40kg',
                        ripeness: '95%',
                        startArea: '„Ç®„É™„Ç¢8 ÈÄöË∑Ø5',
                        endArea: '„Ç®„É™„Ç¢4 ÈÄöË∑Ø5',
                    }
                },
                2: {
                    date: '2024/12/19',
                    startTime: '09:00',
                    endTime: '12:30',
                    totalHarvest: '92.3kg',
                    t7l: {
                        harvest: '40kg',
                        ripeness: '98%',
                        startArea: '„Ç®„É™„Ç¢1 ÈÄöË∑Ø1',
                        endArea: '„Ç®„É™„Ç¢5 ÈÄöË∑Ø1',
                    },
                    t7r: {
                        harvest: '40kg',
                        ripeness: '98%',
                        startArea: '„Ç®„É™„Ç¢8 ÈÄöË∑Ø5',
                        endArea: '„Ç®„É™„Ç¢4 ÈÄöË∑Ø5',
                    }
                },
                3: {
                    date: '2024/12/18',
                    startTime: '08:00',
                    endTime: '10:45',
                    totalHarvest: '78.8kg',
                    t7l: {
                        harvest: '0kg',
                        ripeness: '-',
                        startArea: '-',
                        endArea: '-',
                        direction: '-'
                    },
                    t7r: {
                        harvest: '80kg',
                        ripeness: '93%',
                        startArea: '„Ç®„É™„Ç¢1 ÈÄöË∑Ø1',
                        endArea: '„Ç®„É™„Ç¢8 ÈÄöË∑Ø5',
                    }
                }
            };
            
            const detail = logDetails[logId];
            
            content.innerHTML = `
                <div style="display: grid; gap: 15px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                        <div><strong>ÂèéÁ©´Êó•:</strong> ${detail.date}</div>
                        <div><strong>Á∑èÂèéÁ©´Èáè:</strong> ${detail.totalHarvest}</div>
                        <div><strong>ÈñãÂßãÊôÇÂàª:</strong> ${detail.startTime}</div>
                        <div><strong>ÁµÇ‰∫ÜÊôÇÂàª:</strong> ${detail.endTime}</div>
                    </div>
                    
                    <div style="border: 2px solid #FF6B6B; border-radius: 5px; padding: 15px;">
                        <h4 style="color: #FF6B6B; margin-bottom: 10px;">„Åç„Å§„Å≠Âè∑ Ë®≠ÂÆö</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <div><strong>ÂèéÁ©´Èáè:</strong> ${detail.t7l.harvest}</div>
                            <div><strong>ÂÆåÁÜüÂ∫¶:</strong> ${detail.t7l.ripeness}</div>
                            <div><strong>ÈñãÂßã‰ΩçÁΩÆ:</strong> ${detail.t7l.startArea}</div>
                            <div><strong>ÁµÇ‰∫Ü‰ΩçÁΩÆ:</strong> ${detail.t7l.endArea}</div>
                        </div>
                    </div>
                    
                    <div style="border: 2px solid #4A90E2; border-radius: 5px; padding: 15px;">
                        <h4 style="color: #4A90E2; margin-bottom: 10px;">„Åü„Å¨„ÅçÂè∑ Ë®≠ÂÆö</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <div><strong>ÂèéÁ©´Èáè:</strong> ${detail.t7r.harvest}</div>
                            <div><strong>ÂÆåÁÜüÂ∫¶:</strong> ${detail.t7r.ripeness}</div>
                            <div><strong>ÈñãÂßã‰ΩçÁΩÆ:</strong> ${detail.t7r.startArea}</div>
                            <div><strong>ÁµÇ‰∫Ü‰ΩçÁΩÆ:</strong> ${detail.t7r.endArea}</div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }
        
        // „É≠„Ç∞Ë©≥Á¥∞„ÇíÈñâ„Åò„Çã
        function closeLogDetail() {
            document.getElementById('logDetailModal').style.display = 'none';
        }
        
        // „É≠„Ç∞Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´„ÅÆÂ§ñÂÅ¥„Çí„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        document.getElementById('logDetailModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeLogDetail();
            }
        });
        
        // „Éû„Éã„É•„Ç¢„É´ÂÜÖÂÆπ
        const manualContentHtml = `
            <div style="line-height: 1.8; font-size: 16px;">
                <section style="margin-bottom: 25px;">
                    <h3 style="color: #66bb6a; margin-bottom: 10px;">1. ‰ΩúÊ•≠„ÅÆÊµÅ„Çå</h3>
                    <ol style="padding-left: 20px;">
                        <li><strong>ÂèéÁ©´Ë®≠ÂÆöÔºö</strong> Êú¨„Ç¢„Éó„É™„ÅßÂèéÁ©´Ë®àÁîª„ÇíË®≠ÂÆö„Åô„Çã</li>
                        <li><strong>„É≠„Éú„ÉÉ„ÉàÁßªÂãïÔºö</strong> ÁèæÂ†¥„ÅßÂêÑ„É≠„Éú„ÉÉ„Éà„ÇíÊìç‰Ωú„Åó„Å¶ÈñãÂßãÂú∞ÁÇπ„Åæ„ÅßÈÅã„Å∂</li>
                        <li><strong>ÂèéÁ©´ÂÆüË°åÔºö</strong> ÁèæÂ†¥„ÅßË®≠ÂÆöÁ¢∫Ë™çÂæå„ÄÅÂèéÁ©´„ÇíÈñãÂßã„Åô„Çã</li>
                        <li><strong>„Ç®„É©„ÉºÂØæÂøúÔºö</strong> „Ç®„É©„ÉºÁô∫ÁîüÊôÇ„ÅÆÂØæÂøú„Å®Âæ©Êóß‰ΩúÊ•≠</li>
                        <li><strong>ÂèéÁ©´Âæå‰ΩúÊ•≠Ôºö</strong> „Éà„Éû„Éà„ÇíÂõûÂèé„Åó„Å¶„É≠„Éú„ÉÉ„Éà„ÇíÂÖÖÈõª„Åô„Çã</li>
                    </ol>
                </section>
                
                <section style="margin-bottom: 25px;">
                    <h3 style="color: #66bb6a; margin-bottom: 10px;">2. ÂèéÁ©´Ë®≠ÂÆöÊâãÈ†Ü</h3>
                    <ol style="padding-left: 20px;">
                        <li>ÂêÑ„É≠„Éú„ÉÉ„Éà„ÅÆÁä∂ÊÖã„Å®‰ΩçÁΩÆ„ÇíÁ¢∫Ë™ç</li>
                        <li><strong>„ÇØ„Ç§„ÉÉ„ÇØË®≠ÂÆö</strong>„Åã„Çâ„Éó„É™„Çª„ÉÉ„Éà„ÇíÈÅ∏Êäû</li>
                        <li><strong>Ë©≥Á¥∞Ë®≠ÂÆö</strong>„ÇíÁ¢∫Ë™ç„ÉªÁ∑®ÈõÜ</li>
                        <li>„ÄåÁµåË∑ØÁ¢∫Ë™ç„Äç„ÅßÁßªÂãïËªåË∑°„ÇíÁ¢∫Ë™ç</li>
                        <li>„ÄåÁ¢∫ÂÆö„Äç„ÅßÂêÑ„É≠„Éú„ÉÉ„Éà„Å´Ë®≠ÂÆö„ÇíÈÄÅ‰ø°</li>
                    </ol>
                </section>
                
                <section style="margin-bottom: 25px;">
                    <h3 style="color: #66bb6a; margin-bottom: 10px;">3. ÁèæÂ†¥„Åß„ÅÆ„É≠„Éú„ÉÉ„ÉàÊìç‰Ωú</h3>
                    <h4 style="color: #81c784; margin: 10px 0;">ÁßªÂãïÊ∫ñÂÇô</h4>
                    <ul style="padding-left: 20px;">
                        <li>„É≠„Éú„ÉÉ„Éà„Å´Á©∫„ÅÆÂèéÁ©´„Ç´„Ç¥„Çí„Çª„ÉÉ„Éà</li>
                        <li>„Ç∏„Éß„Ç§„Çπ„ÉÜ„Ç£„ÉÉ„ÇØ„ÅßÈñãÂßãÂú∞ÁÇπ„Åæ„ÅßÁßªÂãï</li>
                        <li>ÈÄöË∑Ø„ÅÆÈöúÂÆ≥Áâ©„ÇíÁ¢∫Ë™ç</li>
                    </ul>
                    
                    <h4 style="color: #81c784; margin: 10px 0;">ÂèéÁ©´ÈñãÂßã</h4>
                    <ul style="padding-left: 20px;">
                        <li>„É≠„Éú„ÉÉ„ÉàÊê≠Ëºâ„Éá„Ç£„Çπ„Éó„É¨„Ç§„ÅßË®≠ÂÆöÁ¢∫Ë™ç</li>
                        <li>„É≠„Éú„ÉÉ„ÉàÊê≠ËºâÁâ©ÁêÜ„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶ÂèéÁ©´ÈñãÂßã</li>
                    </ul>
                    
                    <h4 style="color: #81c784; margin: 10px 0;">ÂèéÁ©´Âæå</h4>
                    <ul style="padding-left: 20px;">
                        <li>ÂèéÁ©´„Ç´„Ç¥„ÇíÂõûÂèé</li>
                        <li>„Ç∏„Éß„Ç§„Çπ„ÉÜ„Ç£„ÉÉ„ÇØ„ÅßÂÖÖÈõªÂú∞ÁÇπ„Åæ„ÅßÁßªÂãï</li>
                        <li>ÂÖÖÈõªÈñãÂßã</li>
                    </ul>
                </section>
                
                <section style="margin-bottom: 25px;">
                    <h3 style="color: #66bb6a; margin-bottom: 10px;">4. „Éû„ÉÉ„Éó„ÅÆË¶ãÊñπ</h3>
                    <ul style="padding-left: 20px;">
                        <li><strong>„Ç®„É™„Ç¢Ôºö</strong> Ëæ≤Â†¥„ÅØ8„Å§„ÅÆ„Ç®„É™„Ç¢„Å´ÂàÜÂâ≤ÔºàÂåóÂÅ¥1-4„ÄÅÂçóÂÅ¥5-8Ôºâ</li>
                        <li><strong>ÈÄöË∑ØÔºö</strong> ÂêÑ„Ç®„É™„Ç¢„Å´5„Å§„ÅÆÈÄöË∑ØÔºà1-5„ÅÆÁï™Âè∑‰ªò„ÅçÔºâ</li>
                        <li><strong>ÁïùÔºö</strong> ÈªÑÁ∑ëËâ≤„ÅÆÁ∑ö„ÅßË°®Á§∫ÔºàÂêÑ„Ç®„É™„Ç¢4Êú¨Ôºâ</li>
                        <li><strong>„É≠„Éú„ÉÉ„Éà‰ΩçÁΩÆÔºö</strong> ‰∏âËßíÂΩ¢„Éû„Éº„Ç´„ÉºÔºà„Åç„Å§„Å≠Âè∑:Ëµ§„ÄÅ„Åü„Å¨„ÅçÂè∑:ÈùíÔºâ</li>
                        <li><strong>ÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥Ôºö</strong> Ë•øÂÅ¥ÔºàÂ∑¶ÂÅ¥Ôºâ„Å´ÈÖçÁΩÆ</li>
                    </ul>
                </section>
                
                <section style="margin-bottom: 25px; background: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid #2196f3;">
                    <h3 style="color: #1565c0; margin-bottom: 10px;">üí° „Ç®„É©„ÉºÂØæÂøú</h3>
                    <ul style="padding-left: 20px;">
                        <li><strong>„Éê„É≥„Éë„ÉºÂèçÂøú„Åß„É≠„Éú„ÉÉ„Éà„ÅåÂÅúÊ≠¢„Åó„ÅüÂ†¥ÂêàÔºö</strong>
                            <ul style="padding-left: 20px;">
                                <li>„É≠„Éú„ÉÉ„ÉàÊê≠Ëºâ„Éá„Ç£„Çπ„Éó„É¨„Ç§„ÅÆÊåáÁ§∫„Å´Âæì„ÅÑ„ÄÅÈöúÂÆ≥Áâ©„ÇíÈô§Âéª</li>
                                <li>„ÄåÂÜçÈñã„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶ÂèéÁ©´„ÇíÁ∂öË°å</li>
                            </ul>
                        </li>
                        <li><strong>Âê∏Âºï„Ç®„É©„Éº„Åß„É≠„Éú„ÉÉ„Éà„ÅåÂÅúÊ≠¢„Åó„ÅüÂ†¥ÂêàÔºö</strong>
                            <ul style="padding-left: 20px;">
                                <li>„É≠„Éú„ÉÉ„ÉàÊê≠Ëºâ„Éá„Ç£„Çπ„Éó„É¨„Ç§„ÅÆÊåáÁ§∫„Å´Âæì„ÅÑ„ÄÅÂê∏ÂºïÁâ©„ÇíÈô§Âéª</li>
                                <li>„ÄåÂÜçÈñã„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶ÂèéÁ©´„ÇíÁ∂öË°å</li>
                            </ul>
                        </li>
                        <li><strong>„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢„Ç®„É©„ÉºÔºö</strong> Slack„ÅßÈñãÁô∫ËÄÖ„Å´ÈÄ£Áµ°„Åô„Çã</li>
                        <li><strong>„É≠„Éú„ÉÉ„Éà„ÅåÊö¥Ëµ∞„Åó„ÅüÂ†¥ÂêàÔºö</strong> ÈùûÂ∏∏ÂÅúÊ≠¢„Éú„Çø„É≥„Åæ„Åü„ÅØÁÑ°Á∑ö„É™„É¢„Ç≥„É≥„ÅßÂç≥ÊôÇÂÅúÊ≠¢„Åô„Çã</li>
                    </ul>
                </section>
                
                <section style="margin-bottom: 25px; background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                    <h3 style="color: #856404; margin-bottom: 10px;">‚ö†Ô∏è Ê≥®ÊÑè‰∫ãÈ†Ö</h3>
                    <ul style="padding-left: 20px;">
                        <li>‰ΩúÊ•≠Ââç„Å´ÂøÖ„ÅöÂë®Âõ≤„ÅÆÂÆâÂÖ®„ÇíÁ¢∫Ë™ç„Åô„Çã„Åì„Å®</li>
                    </ul>
                </section>
                
                <section style="margin-bottom: 25px;">
                    <h3 style="color: #66bb6a; margin-bottom: 10px;">5. ÈÅéÂéª„ÅÆÂèéÁ©´Ë®òÈå≤</h3>
                    <p>ÈÅéÂéª„ÅÆÂèéÁ©´Ë®òÈå≤„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô„ÄÇÂêÑË®òÈå≤„ÅÆ„ÄåË©≥Á¥∞„Äç„Éú„Çø„É≥„Åã„Çâ„ÄÅ„Åù„ÅÆÊôÇ„ÅÆË®≠ÂÆöÂÜÖÂÆπÔºàÈñãÂßã/ÁµÇ‰∫Ü‰ΩçÁΩÆ„ÄÅÂèéÁ©´Èáè„ÄÅÂÆåÁÜüÂ∫¶„Å™„Å©Ôºâ„ÇíÁ¢∫Ë™çÂèØËÉΩ„Åß„Åô„ÄÇ</p>
                </section>
            </div>
        `;

        // „Éû„Éã„É•„Ç¢„É´„ÇíË°®Á§∫
        function showManual() {
            document.getElementById('manualContent').innerHTML = manualContentHtml;
            document.getElementById('manualModal').style.display = 'block';
        }
        
        // „Éû„Éã„É•„Ç¢„É´„ÇíÈñâ„Åò„Çã
        function closeManual() {
            document.getElementById('manualModal').style.display = 'none';
        }
        
        // „Éû„Éã„É•„Ç¢„É´„É¢„Éº„ÉÄ„É´„ÅÆÂ§ñÂÅ¥„Çí„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        document.getElementById('manualModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeManual();
            }
        });
        
        // ÈÄÅ‰ø°ÁµêÊûú„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeSendResult() {
            document.getElementById('sendResultModal').style.display = 'none';
        }
        
        // ÈÄÅ‰ø°ÁµêÊûú„É¢„Éº„ÉÄ„É´„ÅÆÂ§ñÂÅ¥„Çí„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        document.getElementById('sendResultModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeSendResult();
            }
        });
        
        // Ë®≠ÂÆö„ÇíÂêÑ„É≠„Éú„ÉÉ„Éà„Å´ÈÄÅ‰ø°
        function sendSettings() {
            // Ë©≥Á¥∞Ë®≠ÂÆö„Åã„ÇâÁèæÂú®„ÅÆÂÄ§„ÇíÂèñÂæó
            const settings = {
                t7l: {
                    startArea: document.getElementById('startArea1').value,
                    startLane: document.getElementById('startLane1').value,
                    endArea: document.getElementById('endArea1').value,
                    endLane: document.getElementById('endLane1').value,
                    harvest: document.getElementById('harvest1').value,
                    ripeness: document.getElementById('ripeness1').value
                },
                t7r: {
                    startArea: document.getElementById('startArea2').value,
                    startLane: document.getElementById('startLane2').value,
                    endArea: document.getElementById('endArea2').value,
                    endLane: document.getElementById('endLane2').value,
                    harvest: document.getElementById('harvest2').value,
                    ripeness: document.getElementById('ripeness2').value
                }
            };
            
            // ÈÄÅ‰ø°ÊôÇÂàª„ÇíË®òÈå≤
            const now = new Date();
            const sendTime = now.toLocaleString('ja-JP');
            
            // ÈÄÅ‰ø°ÁµêÊûú„ÅÆHTMLÁîüÊàê
            const resultHtml = `
                <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="font-size: 18px; color: #2e7d32; margin-bottom: 10px;">
                        <strong>‚úÖ ÈÄÅ‰ø°ÊàêÂäü</strong>
                    </p>
                    <p style="font-size: 16px; color: #666;">
                        ÈÄÅ‰ø°ÊôÇÂàª: ${sendTime}
                    </p>
                </div>
                
                <div style="border: 2px solid #FF6B6B; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                    <h3 style="color: #FF6B6B; margin-bottom: 12px; font-size: 20px;">
                        <span style="display: inline-block; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 10px solid #FF6B6B; margin-right: 8px;"></span>
                        „Åç„Å§„Å≠Âè∑ ÈÄÅ‰ø°ÂÜÖÂÆπ
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 16px;">
                        <div><strong>ÈñãÂßã‰ΩçÁΩÆ:</strong> „Ç®„É™„Ç¢${settings.t7l.startArea} ÈÄöË∑Ø${settings.t7l.startLane}</div>
                        <div><strong>ÁµÇ‰∫Ü‰ΩçÁΩÆ:</strong> „Ç®„É™„Ç¢${settings.t7l.endArea} ÈÄöË∑Ø${settings.t7l.endLane}</div>
                        <div><strong>ÂõûËª¢ÊñπÂêë:</strong> ${settings.t7l.direction}</div>
                        <div><strong>ÂèéÁ©´Èáè:</strong> ${settings.t7l.harvest}kg</div>
                        <div><strong>ÂÆåÁÜüÂ∫¶:</strong> ${settings.t7l.ripeness}%</div>
                    </div>
                </div>
                
                <div style="border: 2px solid #4A90E2; border-radius: 8px; padding: 15px;">
                    <h3 style="color: #4A90E2; margin-bottom: 12px; font-size: 20px;">
                        <span style="display: inline-block; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 10px solid #4A90E2; margin-right: 8px;"></span>
                        „Åü„Å¨„ÅçÂè∑ ÈÄÅ‰ø°ÂÜÖÂÆπ
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 16px;">
                        <div><strong>ÈñãÂßã‰ΩçÁΩÆ:</strong> „Ç®„É™„Ç¢${settings.t7r.startArea} ÈÄöË∑Ø${settings.t7r.startLane}</div>
                        <div><strong>ÁµÇ‰∫Ü‰ΩçÁΩÆ:</strong> „Ç®„É™„Ç¢${settings.t7r.endArea} ÈÄöË∑Ø${settings.t7r.endLane}</div>
                        <div><strong>ÂõûËª¢ÊñπÂêë:</strong> ${settings.t7r.direction}</div>
                        <div><strong>ÂèéÁ©´Èáè:</strong> ${settings.t7r.harvest}kg</div>
                        <div><strong>ÂÆåÁÜüÂ∫¶:</strong> ${settings.t7r.ripeness}%</div>
                    </div>
                </div>
            `;
            
            // ÁµêÊûú„ÇíË°®Á§∫
            document.getElementById('sendResultContent').innerHTML = resultHtml;
            document.getElementById('sendResultModal').style.display = 'block';
            
            // „Åì„Åì„ÅßÂÆüÈöõ„ÅÆÈÄÅ‰ø°Âá¶ÁêÜ„ÇíË°å„ÅÜÔºàAPIÂëº„Å≥Âá∫„Åó„Å™„Å©Ôºâ
            console.log('ÈÄÅ‰ø°Ë®≠ÂÆö:', settings);
        }

        // „Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆö
        function applyPreset() {
            const presetSelect = document.getElementById('presetSelect');
            const selectedPreset = presetSelect.value;
            
            // ‰∏ÄÊôÇÁöÑ„Å´selectË¶ÅÁ¥†„ÇíÊúâÂäπÂåñ„Åó„Å¶„Åã„ÇâË®≠ÂÆö
            const selects = document.querySelectorAll('#detailSettings select');
            const wasDisabled = [];
            
            // ÁèæÂú®„ÅÆÁä∂ÊÖã„ÇíË®òÈå≤„Åó„ÄÅ‰∏ÄÊôÇÁöÑ„Å´ÊúâÂäπÂåñ
            selects.forEach((select, index) => {
                wasDisabled[index] = select.disabled;
                select.disabled = false;
            });
            
            if (selectedPreset === 'two-robots') {
                // 2Âè∞„ÅßÂÖ®Èù¢ÂèéÁ©´Ôºà„Éá„Éï„Ç©„É´„ÉàË®≠ÂÆöÔºâ
                // „Åç„Å§„Å≠Âè∑: „Ç®„É™„Ç¢1„Åã„Çâ5ÈÄöË∑Ø1„Åæ„ÅßÊãÖÂΩì
                document.getElementById('startArea1').value = '1';
                document.getElementById('startLane1').value = '1';
                document.getElementById('endArea1').value = '5';
                document.getElementById('endLane1').value = '1';
                
                // „Åü„Å¨„ÅçÂè∑: „Ç®„É™„Ç¢8ÈÄöË∑Ø5„Åã„Çâ4ÈÄöË∑Ø5„Åæ„ÅßÊãÖÂΩì
                document.getElementById('startArea2').value = '8';
                document.getElementById('startLane2').value = '5';
                document.getElementById('endArea2').value = '4';
                document.getElementById('endLane2').value = '5';
            } else if (selectedPreset === 'left-robot-only') {
                // „Åç„Å§„Å≠Âè∑„ÅßÂÖ®Èù¢ÂèéÁ©´
                // „Åç„Å§„Å≠Âè∑: ÂÖ®„Ç®„É™„Ç¢„ÇíÊãÖÂΩì
                document.getElementById('startArea1').value = '1';
                document.getElementById('startLane1').value = '1';
                document.getElementById('endArea1').value = '8';
                document.getElementById('endLane1').value = '5';
                
                // „Åü„Å¨„ÅçÂè∑: ÁÑ°ÂäπÂåñÔºàÂêå„Åò‰ΩçÁΩÆ„Å´Ë®≠ÂÆöÔºâ
                document.getElementById('startArea2').value = '8';
                document.getElementById('startLane2').value = '5';
                document.getElementById('endArea2').value = '8';
                document.getElementById('endLane2').value = '5';
            } else if (selectedPreset === 'right-robot-only') {
                // „Åü„Å¨„ÅçÂè∑„ÅßÂÖ®Èù¢ÂèéÁ©´
                // „Åç„Å§„Å≠Âè∑: ÁÑ°ÂäπÂåñÔºàÂêå„Åò‰ΩçÁΩÆ„Å´Ë®≠ÂÆöÔºâ
                document.getElementById('startArea1').value = '1';
                document.getElementById('startLane1').value = '1';
                document.getElementById('endArea1').value = '1';
                document.getElementById('endLane1').value = '1';
                
                // „Åü„Å¨„ÅçÂè∑: ÂÖ®„Ç®„É™„Ç¢„ÇíÊãÖÂΩì
                document.getElementById('startArea2').value = '1';
                document.getElementById('startLane2').value = '1';
                document.getElementById('endArea2').value = '8';
                document.getElementById('endLane2').value = '5';
            }
            // „Ç´„Çπ„Çø„É†ÂèéÁ©´1,2„ÅÆÂ†¥Âêà„ÅØÁèæÂú®„ÅÆË®≠ÂÆö„ÇíÁ∂≠ÊåÅ
            
            // ÂÖÉ„ÅÆÁä∂ÊÖã„Å´Êàª„Åô
            selects.forEach((select, index) => {
                select.disabled = wasDisabled[index];
            });
            
            console.log('„Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆö„ÇíÈÅ©Áî®:', selectedPreset);
        }

        // „Éû„ÉÉ„ÉóÊèèÁîª
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // „Çπ„Ç±„Éº„É´Ë®≠ÂÆöÔºà1m = 15px - 1.5ÂÄç„Å´Êã°Â§ßÔºâ
        const scale = 15;
        const farmWidth = 32 * scale; // 480px
        const farmHeight = 62.5 * scale; // 937.5px
        const centralPathWidth = 2.5 * scale; // 37.5px
        const ridgeWidth = 0.6 * scale; // 9px
        const ridgeLength = 30 * scale; // 450px
        const pathWidth = 1 * scale; // 15px
        const pillarSize = 0.3 * scale; // 4.5px
        const areaWidth = 8 * scale; // 120px
        
        // „Éû„Éº„Ç∏„É≥„ÇíËøΩÂä†ÔºàÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥ÂàÜ„ÇÇËÄÉÊÖÆÔºâ
        const leftMargin = 98; // ÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥Áî®„ÅÆÂπÖ„ÅÑ‰ΩôÁôΩÔºà1.5ÂÄçÔºâ
        const rightMargin = 23; // Âè≥ÂÅ¥„ÅÆÁ¥∞„ÅÑ‰ΩôÁôΩÔºà1.5ÂÄçÔºâ
        const topBottomMargin = 23; // ‰∏ä‰∏ã„ÅÆ‰ΩôÁôΩÔºà1.5ÂÄçÔºâ
        canvas.width = farmWidth + leftMargin + rightMargin;
        canvas.height = farmHeight + topBottomMargin * 2;
        
        // Ëâ≤„ÅÆÂÆöÁæ©
        const colors = {
            ridge: '#90EE90',        // ÈªÑÁ∑ëËâ≤
            centralPath: '#F5F5F5',  // ÈùûÂ∏∏„Å´ËñÑ„ÅÑ„Ç∞„É¨„ÉºÔºà„Åª„ÅºÁôΩÔºâ
            pathBetween: '#FFFFFF',  // ÁôΩËâ≤ÔºàÁïùÈñìÈÄöË∑ØÔºâ
            pillar: '#666666',       // ÊøÉ„ÅÑ„Ç∞„É¨„Éº
            border: '#333333',       // Èªí
            background: '#FFFFFF',   // ÁôΩ
            text: '#000000',         // ÈªíÔºà„ÉÜ„Ç≠„Çπ„ÉàÁî®Ôºâ
            chargingStation: '#FFFFFF', // ÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥ÔºàÁôΩËâ≤Ôºâ
            robot1: '#FF6B6B',       // „Åç„Å§„Å≠Âè∑ÔºàËµ§Ëâ≤Ôºâ
            robot2: '#4A90E2'        // „Åü„Å¨„ÅçÂè∑ÔºàÈùíËâ≤Ôºâ
        };
        
        // „É≠„Éú„ÉÉ„Éà„ÅÆ‰ΩçÁΩÆÊÉÖÂ†±ÔºàÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥ÂÜÖÔºâ
        let robotPositions = {
            robot1: { x: leftMargin - 60, y: topBottomMargin + farmHeight / 2 - 15, angle: 0 }, // „Åç„Å§„Å≠Âè∑ - ÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥ÂÜÖ
            robot2: { x: leftMargin - 30, y: topBottomMargin + farmHeight / 2 + 15, angle: 0 }  // „Åü„Å¨„ÅçÂè∑ - ÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥ÂÜÖ
        };
        
        function drawFarm() {
            // ËÉåÊôØ„Çí„ÇØ„É™„Ç¢
            ctx.fillStyle = colors.background;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Ëæ≤Â†¥ÂÖ®‰Ωì„ÇíËå∂Ëâ≤„ÅßÂ°ó„Çä„Å§„Å∂„ÅôÔºàÈÄöË∑Ø„ÅÆ„Éô„Éº„ÇπÔºâ
            ctx.fillStyle = colors.pathBetween;
            ctx.fillRect(leftMargin, topBottomMargin, farmWidth, farmHeight);
            
            // Êù±Ë•ø‰∏≠Â§ÆÈÄöË∑Ø„ÇíÊèèÁîª
            const centralPathY = topBottomMargin + (farmHeight - centralPathWidth) / 2;
            ctx.fillStyle = colors.centralPath;
            ctx.fillRect(leftMargin, centralPathY, farmWidth, centralPathWidth);
            
            // „Ç®„É™„Ç¢„Å®Áïù„ÇíÊèèÁîª
            for (let i = 0; i < 8; i++) {
                const row = i < 4 ? 0 : 1;
                const col = i % 4;
                const areaX = leftMargin + col * areaWidth;
                let areaY;
                
                if (row === 0) {
                    // ÂåóÂÅ¥„Ç®„É™„Ç¢Ôºà1-4Ôºâ
                    areaY = topBottomMargin;
                } else {
                    // ÂçóÂÅ¥„Ç®„É™„Ç¢Ôºà5-8Ôºâ- ‰∏≠Â§ÆÈÄöË∑Ø„Å´Áõ¥Êé•Êé•Á∂ö
                    areaY = centralPathY + centralPathWidth;
                }
                
                // Áïù„ÇíÊèèÁîªÔºà„Ç®„É™„Ç¢ÂπÖ„Çí5Á≠âÂàÜ„Åó„Å¶„ÄÅÊü±„Å®Êü±„ÅÆÈñì„Å´Áïù„ÇíÈÖçÁΩÆÔºâ
                // „Ç®„É™„Ç¢ÂπÖ = 120px„ÄÅ5„Å§„ÅÆÈÄöË∑ØÔºàÂêÑ24pxÔºâ„Å´ÂàÜÂâ≤
                const laneWidth = areaWidth / 5; // 24px per lane
                for (let j = 0; j < 4; j++) {
                    // ÂêÑÁïù„ÇíÈÄöË∑Ø„ÅÆ‰∏≠Â§Æ„Å´ÈÖçÁΩÆÔºàÈÄöË∑Ø1„Å®5„ÇíÈô§„ÅèÔºâ
                    const ridgeX = areaX + (j + 1) * laneWidth - ridgeWidth / 2;
                    let ridgeY, adjustedRidgeLength;
                    
                    if (row === 0) {
                        // ÂåóÂÅ¥„Ç®„É™„Ç¢ - ‰∏äÁ´Ø„Åã„Çâ‰∏≠Â§ÆÈÄöË∑Ø„Åæ„Åß
                        ridgeY = areaY + pathWidth;
                        adjustedRidgeLength = centralPathY - ridgeY;
                    } else {
                        // ÂçóÂÅ¥„Ç®„É™„Ç¢ - ‰∏≠Â§ÆÈÄöË∑Ø„Åã„Çâ‰∏ãÁ´Ø„Åæ„Åß
                        ridgeY = centralPathY + centralPathWidth;
                        adjustedRidgeLength = (topBottomMargin + farmHeight) - ridgeY - pathWidth;
                    }
                    
                    ctx.fillStyle = colors.ridge;
                    ctx.fillRect(ridgeX, ridgeY, ridgeWidth, adjustedRidgeLength);
                }
            }
            
            // Êü±„ÇíÊèèÁîª
            ctx.fillStyle = colors.pillar;
            for (let i = 0; i <= 4; i++) {
                for (let j = 0; j <= 25; j++) {
                    const x = leftMargin + i * areaWidth;
                    const y = topBottomMargin + j * 2.5 * scale;
                    ctx.fillRect(x - pillarSize / 2, y - pillarSize / 2, pillarSize, pillarSize);
                }
            }
            
            // Ëæ≤Â†¥„ÅÆÂ§ñÊû†
            ctx.strokeStyle = colors.border;
            ctx.lineWidth = 2;
            ctx.strokeRect(leftMargin, topBottomMargin, farmWidth, farmHeight);
            
            // ÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥„ÇíÊèèÁîªÔºàË•øÂÅ¥„ÄÅ‰∏≠Â§ÆÈÄöË∑Ø„ÅÆÂ∑¶Á´Ø„Å´Êé•„Åó„Å¶Ôºâ
            const chargingStationSize = 90; // 1.5ÂÄç„ÅÆ„Çµ„Ç§„Ç∫
            const chargingStationX = leftMargin - chargingStationSize; // Âè≥Á´Ø„Åå‰∏≠Â§ÆÈÄöË∑Ø„ÅÆÂ∑¶Á´Ø„Å´Êé•„Åô„Çã
            const chargingStationY = centralPathY + (centralPathWidth - chargingStationSize) / 2;
            
            // ÂÖÖÈõªÂ†¥ÊâÄ„ÅÆ„É©„Éô„É´Ôºà‰∏ä„Å´Ë°®Á§∫Ôºâ
            ctx.fillStyle = colors.text;
            ctx.font = 'bold 21px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ÂÖÖÈõªÂ†¥ÊâÄ', chargingStationX + chargingStationSize / 2, chargingStationY - 8);
            
            // ÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥Êú¨‰Ωì
            ctx.fillStyle = colors.chargingStation;
            ctx.fillRect(chargingStationX, chargingStationY, chargingStationSize, chargingStationSize);
            ctx.strokeStyle = colors.border;
            ctx.lineWidth = 2;
            ctx.strokeRect(chargingStationX, chargingStationY, chargingStationSize, chargingStationSize);
            
            // Êñπ‰Ωç„Éû„Éº„ÇØ„ÇíË°®Á§∫
            drawCompass();
            
            // „Ç®„É™„Ç¢Áï™Âè∑„ÇíÊúÄÂâçÈù¢„Å´Ë°®Á§∫ÔºàÂêÑ„Ç®„É™„Ç¢„ÅÆÂçóÂåóÊñπÂêë„ÅÆ‰∏≠Â§ÆÔºâ
            ctx.fillStyle = colors.text;
            ctx.font = 'bold 21px Arial';
            ctx.textAlign = 'left';
            for (let i = 0; i < 8; i++) {
                const row = i < 4 ? 0 : 1;
                const col = i % 4;
                const areaX = leftMargin + col * areaWidth + areaWidth / 2 - 30;
                let textY;
                
                if (row === 0) {
                    // ÂåóÂÅ¥„Ç®„É™„Ç¢Ôºà1-4Ôºâ- ÂåóÁ´Ø„Åã„Çâ‰∏≠Â§ÆÈÄöË∑Ø„Åæ„Åß„ÅÆ‰∏≠Â§Æ
                    const areaTop = topBottomMargin;
                    const areaBottom = centralPathY;
                    textY = (areaTop + areaBottom) / 2 + 3;
                } else {
                    // ÂçóÂÅ¥„Ç®„É™„Ç¢Ôºà5-8Ôºâ- ‰∏≠Â§ÆÈÄöË∑Ø„Åã„ÇâÂçóÁ´Ø„Åæ„Åß„ÅÆ‰∏≠Â§Æ
                    const areaTop = centralPathY + centralPathWidth;
                    const areaBottom = topBottomMargin + farmHeight;
                    textY = (areaTop + areaBottom) / 2 + 3;
                }
                
                ctx.fillText(`„Ç®„É™„Ç¢${i + 1}`, areaX, textY);
            }
            
            // ÈÄöË∑ØÁï™Âè∑„ÇíË°®Á§∫ÔºàÂêÑ„Ç®„É™„Ç¢„ÅÆÈÄöË∑Ø„Å´ÂØæ„Åó„Å¶Ôºâ
            ctx.fillStyle = colors.text;
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            
            for (let i = 0; i < 8; i++) {
                const row = i < 4 ? 0 : 1;
                const col = i % 4;
                const areaX = leftMargin + col * areaWidth;
                
                // ÂêÑ„Ç®„É™„Ç¢„Å´5„Å§„ÅÆÈÄöË∑ØÁï™Âè∑„ÇíË°®Á§∫
                const laneWidth = areaWidth / 5; // „Ç®„É™„Ç¢ÂπÖ„Çí5Á≠âÂàÜ
                for (let j = 0; j < 5; j++) {
                    // ÂêÑÈÄöË∑Ø„ÅÆ‰∏≠Â§Æ„Å´Áï™Âè∑„ÇíÈÖçÁΩÆ
                    const laneX = areaX + (j + 0.5) * laneWidth;
                    
                    let laneY;
                    if (row === 0) {
                        // ÂåóÂÅ¥„Ç®„É™„Ç¢ - ‰∏äÈÉ®„Å´Ë°®Á§∫
                        laneY = topBottomMargin + 40;
                    } else {
                        // ÂçóÂÅ¥„Ç®„É™„Ç¢ - ‰∏ãÈÉ®„Å´Ë°®Á§∫
                        laneY = topBottomMargin + farmHeight - 20;
                    }
                    
                    // ÈÄöË∑ØÁï™Âè∑„ÇíË°®Á§∫
                    ctx.fillStyle = colors.text;
                    ctx.fillText(`${j + 1}`, laneX, laneY);
                }
            }
            
            // ÁµåË∑Ø„ÇíÊèèÁîªÔºà„É≠„Éú„ÉÉ„Éà„Çà„ÇäÂÖà„Å´ÊèèÁîª„Åó„Å¶ËÉåÊôØ„Å´ÈÖçÁΩÆÔºâ
            // const hasPath = Array.isArray(currentPaths) ? currentPaths.length > 0 : 
            //                (currentPaths.kitsune && currentPaths.tanuki);
            // if (hasPath) {
            //     drawPaths();
            // }
            
            // ÁïùÂ¢ÉÁïåÁ∑ö„ÇíÊèèÁîª
            const hasPath = Array.isArray(currentPaths) ? currentPaths.length > 0 : 
                           (currentPaths.kitsune && currentPaths.tanuki);
            if (hasPath) {
                drawFurrowBoundaries();
            }
            
            // „É≠„Éú„ÉÉ„Éà„ÇíÊèèÁîª
            // ÁµåË∑ØË°®Á§∫‰∏≠„ÅØË©≤ÂΩì„É≠„Éú„ÉÉ„Éà„ÇíËñÑ„ÅÑËâ≤„ÅßË°®Á§∫
            const presetSelect = document.getElementById('presetSelect');
            const selectedPreset = presetSelect.value;
            
            let robot1Color = colors.robot1;
            let robot2Color = colors.robot2;
            
            if (currentPaths.length > 0) {
                if (selectedPreset === 'left-robot-only') {
                    robot1Color = '#FFB3B3'; // „Åç„Å§„Å≠Âè∑„ÇíËñÑ„ÅÑËâ≤
                } else if (selectedPreset === 'right-robot-only') {
                    robot2Color = '#B3D4FF'; // „Åü„Å¨„ÅçÂè∑„ÇíËñÑ„ÅÑËâ≤
                }
            }
            
            drawRobot(1, robotPositions.robot1.x, robotPositions.robot1.y, robotPositions.robot1.angle, robot1Color);
            drawRobot(2, robotPositions.robot2.x, robotPositions.robot2.y, robotPositions.robot2.angle, robot2Color);
        }
        
        // ÁµåË∑Ø„ÇíÊèèÁîª„Åô„ÇãÈñ¢Êï∞
        function drawPaths() {
            ctx.save();
            
            // ÁÇπÁ∑ö„ÅÆ„Çπ„Çø„Ç§„É´Ë®≠ÂÆö
            ctx.setLineDash([5, 5]); // 5pxÊèèÁîª„ÄÅ5pxÁ©∫ÁôΩ
            ctx.lineWidth = 2;
            
            // „Éó„É™„Çª„ÉÉ„Éà„Å´Âøú„Åò„Å¶ÁµåË∑Ø„ÅÆËâ≤„ÇíÂ§âÊõ¥
            const presetSelect = document.getElementById('presetSelect');
            const selectedPreset = presetSelect.value;
            
            if (selectedPreset === 'two-robots' && currentPaths.kitsune && currentPaths.tanuki) {
                // ÔºíÂè∞„É¢„Éº„Éâ„ÅÆÂ†¥Âêà„ÄÅ‰∏°Êñπ„ÅÆÁµåË∑Ø„ÇíÊèèÁîª
                
                // „Åç„Å§„Å≠Âè∑„ÅÆÁµåË∑ØÔºàËµ§Ëâ≤Ôºâ
                ctx.strokeStyle = '#FF6B6B';
                currentPaths.kitsune.forEach(path => {
                    ctx.beginPath();
                    ctx.moveTo(path.startX, path.startY);
                    ctx.lineTo(path.endX, path.endY);
                    ctx.stroke();
                });
                
                // „Åü„Å¨„ÅçÂè∑„ÅÆÁµåË∑ØÔºàÈùíËâ≤Ôºâ
                ctx.strokeStyle = '#4A90E2';
                currentPaths.tanuki.forEach(path => {
                    ctx.beginPath();
                    ctx.moveTo(path.startX, path.startY);
                    ctx.lineTo(path.endX, path.endY);
                    ctx.stroke();
                });
            } else if (Array.isArray(currentPaths)) {
                // Âçò‰Ωì„É≠„Éú„ÉÉ„Éà„É¢„Éº„Éâ„ÅÆÂ†¥Âêà
                let pathColor = '#FF6B6B'; // „Éá„Éï„Ç©„É´„Éà„ÅØ„Åç„Å§„Å≠Âè∑„ÅÆËµ§Ëâ≤
                
                if (selectedPreset === 'right-robot-only') {
                    pathColor = '#4A90E2'; // „Åü„Å¨„ÅçÂè∑„ÅØÈùíËâ≤
                }
                
                ctx.strokeStyle = pathColor;
                currentPaths.forEach(path => {
                    ctx.beginPath();
                    ctx.moveTo(path.startX, path.startY);
                    ctx.lineTo(path.endX, path.endY);
                    ctx.stroke();
                });
            }
            
            ctx.restore();
        }
        
        // ÁïùÂ¢ÉÁïåÁ∑ö„ÇíÊèèÁîª„Åô„ÇãÈñ¢Êï∞
        function drawFurrowBoundaries() {
            const presetSelect = document.getElementById('presetSelect');
            const selectedPreset = presetSelect.value;
            
            if (showStaticBoundaries) {
                // ÈùôÁöÑ„Å™Â¢ÉÁïåÁ∑öË°®Á§∫
                if (selectedPreset === 'left-robot-only') {
                    drawKitsuneFurrowBoundaries();
                } else if (selectedPreset === 'right-robot-only') {
                    drawTanukiFurrowBoundaries();
                } else if (selectedPreset === 'two-robots') {
                    drawKitsuneFurrowBoundaries();
                    drawTanukiFurrowBoundaries();
                }
            } else {
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰∏≠„ÅÆÂ¢ÉÁïåÁ∑öË°®Á§∫
                if (selectedPreset === 'left-robot-only' || selectedPreset === 'two-robots') {
                    drawAnimatedKitsuneBoundaries();
                }
                if (selectedPreset === 'right-robot-only' || selectedPreset === 'two-robots') {
                    drawAnimatedTanukiBoundaries();
                }
            }
        }
        
        // „Åç„Å§„Å≠Âè∑„ÅÆÁïùÂ¢ÉÁïåÁ∑ö„ÇíÊèèÁîª
        function drawKitsuneFurrowBoundaries() {
            ctx.save();
            
            // Á∑ö„ÅÆ„Çπ„Çø„Ç§„É´Ë®≠ÂÆö
            ctx.strokeStyle = '#FF6B6B'; // Ëµ§Ëâ≤
            ctx.lineWidth = 2;
            
            // „Ç®„É™„Ç¢„ÅÆÈ†ÜÁï™: 1,2,3,4,8,7,6,5
            const areaOrder = [1, 2, 3, 4, 8, 7, 6, 5];
            
            areaOrder.forEach(areaNum => {
                const areaIndex = areaNum - 1;
                const row = areaIndex < 4 ? 0 : 1;
                const col = areaIndex % 4;
                
                // „Åç„Å§„Å≠Âè∑„ÅÆÂÆüÈöõ„ÅÆÈÄöË∑ØÈÖçÁΩÆ„Å®Âêå„Åò„Å´„Åô„Çã
                let lanes;
                if (row === 0) {
                    // ÂåóÂÅ¥„Ç®„É™„Ç¢: ÈÄöË∑Ø1„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Å¶2,3,4,5
                    lanes = [2, 3, 4, 5];
                } else {
                    // ÂçóÂÅ¥„Ç®„É™„Ç¢: ÈÄöË∑Ø5„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Å¶4,3,2,1
                    lanes = [4, 3, 2, 1];
                }
                
                lanes.forEach((laneNum) => {
                    // ÈÄöË∑Ø„ÅÆ‰ΩçÁΩÆ„ÇíË®àÁÆó
                    const laneWidth = areaWidth / 5;
                    const laneX = leftMargin + col * areaWidth + (laneNum - 0.5) * laneWidth;
                    
                    // Áïù„Å®ÈÄöË∑Ø„ÅÆÂ¢ÉÁïåÁ∑öÔºàÂåóÂÅ¥„ÅØÂ∑¶ÂÅ¥„ÄÅÂçóÂÅ¥„ÅØÂè≥ÂÅ¥Ôºâ
                    let boundaryX;
                    if (row === 0) {
                        // ÂåóÂÅ¥„Ç®„É™„Ç¢: ÈÄöË∑Ø„ÅÆÂ∑¶ÂÅ¥Ôºà2pxÈÄöË∑ØÂØÑ„ÇäÔºâ
                        boundaryX = laneX - laneWidth / 2 + 4;
                    } else {
                        // ÂçóÂÅ¥„Ç®„É™„Ç¢: ÈÄöË∑Ø„ÅÆÂè≥ÂÅ¥Ôºà2pxÈÄöË∑ØÂØÑ„ÇäÔºâ
                        boundaryX = laneX + laneWidth / 2 - 4;
                    }
                    
                    // YÂ∫ßÊ®ô„ÅÆÁØÑÂõ≤
                    let startY, endY;
                    if (row === 0) {
                        // ÂåóÂÅ¥„Ç®„É™„Ç¢
                        startY = topBottomMargin + pathWidth;
                        endY = topBottomMargin + farmHeight / 2 - centralPathWidth / 2;
                    } else {
                        // ÂçóÂÅ¥„Ç®„É™„Ç¢
                        startY = topBottomMargin + farmHeight / 2 + centralPathWidth / 2;
                        endY = topBottomMargin + farmHeight - pathWidth;
                    }
                    
                    // Â¢ÉÁïåÁ∑ö„ÇíÁõ¥Á∑ö„ÅßÊèèÁîª
                    ctx.beginPath();
                    ctx.moveTo(boundaryX, startY);
                    ctx.lineTo(boundaryX, endY);
                    ctx.stroke();
                });
            });
            
            ctx.restore();
        }
        
        // „Åü„Å¨„ÅçÂè∑„ÅÆÁïùÂ¢ÉÁïåÁ∑ö„ÇíÊèèÁîª
        function drawTanukiFurrowBoundaries() {
            ctx.save();
            
            // Á∑ö„ÅÆ„Çπ„Çø„Ç§„É´Ë®≠ÂÆö
            ctx.strokeStyle = '#4A90E2'; // ÈùíËâ≤
            ctx.lineWidth = 2;
            
            // „Ç®„É™„Ç¢„ÅÆÈ†ÜÁï™: 8,7,6,5,1,2,3,4
            const areaOrder = [8, 7, 6, 5, 1, 2, 3, 4];
            
            areaOrder.forEach(areaNum => {
                const areaIndex = areaNum - 1;
                const row = areaIndex < 4 ? 0 : 1;
                const col = areaIndex % 4;
                
                // „Åü„Å¨„ÅçÂè∑„ÅÆÂÆüÈöõ„ÅÆÈÄöË∑ØÈÖçÁΩÆ„Å®Âêå„Åò„Å´„Åô„Çã
                let lanes;
                if (row === 0) {
                    // ÂåóÂÅ¥„Ç®„É™„Ç¢: ÈÄöË∑Ø5„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Å¶1,2,3,4
                    lanes = [1, 2, 3, 4];
                } else {
                    // ÂçóÂÅ¥„Ç®„É™„Ç¢: ÈÄöË∑Ø1„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Å¶5,4,3,2
                    lanes = [5, 4, 3, 2];
                }
                
                lanes.forEach((laneNum) => {
                    // ÈÄöË∑Ø„ÅÆ‰ΩçÁΩÆ„ÇíË®àÁÆó
                    const laneWidth = areaWidth / 5;
                    const laneX = leftMargin + col * areaWidth + (laneNum - 0.5) * laneWidth;
                    
                    // Áïù„Å®ÈÄöË∑Ø„ÅÆÂ¢ÉÁïåÁ∑öÔºàÂåóÂÅ¥„ÅØÂè≥ÂÅ¥„ÄÅÂçóÂÅ¥„ÅØÂ∑¶ÂÅ¥Ôºâ
                    let boundaryX;
                    if (row === 0) {
                        // ÂåóÂÅ¥„Ç®„É™„Ç¢: ÈÄöË∑Ø„ÅÆÂè≥ÂÅ¥Ôºà2pxÈÄöË∑ØÂØÑ„ÇäÔºâ
                        boundaryX = laneX + laneWidth / 2 - 4;
                    } else {
                        // ÂçóÂÅ¥„Ç®„É™„Ç¢: ÈÄöË∑Ø„ÅÆÂ∑¶ÂÅ¥Ôºà2pxÈÄöË∑ØÂØÑ„ÇäÔºâ
                        boundaryX = laneX - laneWidth / 2 + 4;
                    }
                    
                    // YÂ∫ßÊ®ô„ÅÆÁØÑÂõ≤
                    let startY, endY;
                    if (row === 0) {
                        // ÂåóÂÅ¥„Ç®„É™„Ç¢
                        startY = topBottomMargin + pathWidth;
                        endY = topBottomMargin + farmHeight / 2 - centralPathWidth / 2;
                    } else {
                        // ÂçóÂÅ¥„Ç®„É™„Ç¢
                        startY = topBottomMargin + farmHeight / 2 + centralPathWidth / 2;
                        endY = topBottomMargin + farmHeight - pathWidth;
                    }
                    
                    // Â¢ÉÁïåÁ∑ö„ÇíÁõ¥Á∑ö„ÅßÊèèÁîª
                    ctx.beginPath();
                    ctx.moveTo(boundaryX, startY);
                    ctx.lineTo(boundaryX, endY);
                    ctx.stroke();
                });
            });
            
            ctx.restore();
        }
        
        // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰∏≠„ÅÆ„Åç„Å§„Å≠Âè∑Â¢ÉÁïåÁ∑ö„ÇíÊèèÁîª
        function drawAnimatedKitsuneBoundaries() {
            if (drawnBoundariesKitsune.size === 0) return;
            
            ctx.save();
            ctx.strokeStyle = '#FF6B6B';
            ctx.lineWidth = 2;
            
            drawnBoundariesKitsune.forEach(boundaryKey => {
                const [areaNum, laneNum] = boundaryKey.split('-').map(Number);
                drawSingleBoundary(areaNum, laneNum, 'kitsune');
            });
            
            ctx.restore();
        }
        
        // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰∏≠„ÅÆ„Åü„Å¨„ÅçÂè∑Â¢ÉÁïåÁ∑ö„ÇíÊèèÁîª
        function drawAnimatedTanukiBoundaries() {
            if (drawnBoundariesTanuki.size === 0) return;
            
            ctx.save();
            ctx.strokeStyle = '#4A90E2';
            ctx.lineWidth = 2;
            
            drawnBoundariesTanuki.forEach(boundaryKey => {
                const [areaNum, laneNum] = boundaryKey.split('-').map(Number);
                drawSingleBoundary(areaNum, laneNum, 'tanuki');
            });
            
            ctx.restore();
        }
        
        // Âçò‰∏Ä„ÅÆÂ¢ÉÁïåÁ∑ö„ÇíÊèèÁîª
        function drawSingleBoundary(areaNum, laneNum, robotType) {
            const areaIndex = areaNum - 1;
            const row = areaIndex < 4 ? 0 : 1;
            const col = areaIndex % 4;
            
            const laneWidth = areaWidth / 5;
            const laneX = leftMargin + col * areaWidth + (laneNum - 0.5) * laneWidth;
            
            let boundaryX;
            if (robotType === 'kitsune') {
                if (row === 0) {
                    boundaryX = laneX - laneWidth / 2 + 4;
                } else {
                    boundaryX = laneX + laneWidth / 2 - 4;
                }
            } else { // tanuki
                if (row === 0) {
                    boundaryX = laneX + laneWidth / 2 - 4;
                } else {
                    boundaryX = laneX - laneWidth / 2 + 4;
                }
            }
            
            let startY, endY;
            if (row === 0) {
                startY = topBottomMargin + pathWidth;
                endY = topBottomMargin + farmHeight / 2 - centralPathWidth / 2;
            } else {
                startY = topBottomMargin + farmHeight / 2 + centralPathWidth / 2;
                endY = topBottomMargin + farmHeight - pathWidth;
            }
            
            ctx.beginPath();
            ctx.moveTo(boundaryX, startY);
            ctx.lineTo(boundaryX, endY);
            ctx.stroke();
        }
        
        // Êñπ‰Ωç„Éû„Éº„ÇØ„ÇíÊèèÁîª
        function drawCompass() {
            if (compassImg.complete && compassImg.naturalHeight !== 0) {
                // ÂÖÉÁîªÂÉè„ÅÆ1/8„ÅÆ„Çµ„Ç§„Ç∫„ÅßË°®Á§∫
                const imgWidth = compassImg.naturalWidth / 8;
                const imgHeight = compassImg.naturalHeight / 8;
                const compassX = 10;
                const compassY = 10;
                
                ctx.drawImage(compassImg, compassX, compassY, imgWidth, imgHeight);
            }
        }
        
        // „É≠„Éú„ÉÉ„Éà„Çí‰∫åÁ≠âËæ∫‰∏âËßíÂΩ¢„ÅßÊèèÁîª
        function drawRobot(robotId, x, y, angle, color) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle * Math.PI / 180);
            
            // ‰∫åÁ≠âËæ∫‰∏âËßíÂΩ¢„ÅÆ„Çµ„Ç§„Ç∫
            const size = 12;
            
            ctx.beginPath();
            ctx.moveTo(size, 0);           // ÂÖàÁ´ØÔºàÈÄ≤Ë°åÊñπÂêëÔºâ
            ctx.lineTo(-size/2, -size/2);  // Â∑¶‰∏ã
            ctx.lineTo(-size/2, size/2);   // Â∑¶‰∏ä
            ctx.closePath();
            
            ctx.fillStyle = color;
            ctx.fill();
            ctx.strokeStyle = colors.border;
            ctx.lineWidth = 1;
            ctx.stroke();
            
            
            ctx.restore();
        }
        
        // „É≠„Éú„ÉÉ„Éà„ÅÆ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞„Åô„ÇãÈñ¢Êï∞
        function updateRobotPosition(robotId, x, y, angle = 0) {
            robotPositions[`robot${robotId}`] = { x, y, angle };
            drawFarm(); // „Éû„ÉÉ„Éó„ÇíÂÜçÊèèÁîª
        }
        
        // Êñπ‰Ωç„Éû„Éº„ÇØÁîªÂÉè„Çí‰∫ãÂâç„Å´Ë™≠„ÅøËæº„Åø
        const compassImg = new Image();
        compassImg.src = 'N.png';
        compassImg.onload = function() {
            // ÁîªÂÉèË™≠„ÅøËæº„ÅøÂÆå‰∫ÜÂæå„Å´ÂÜçÊèèÁîª
            drawFarm();
        };
        
        // ÂàùÊúüÊèèÁîª
        drawFarm();
        
        // Á∑®ÈõÜ„É¢„Éº„Éâ„ÅÆÁä∂ÊÖã
        let isEditMode = false;
        
        // „Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
        function updateButtonStates() {
            const editBtn = document.getElementById('editBtn');
            const applyBtn = document.getElementById('applyBtn');
            const clearBtn = document.getElementById('clearBtn');
            
            if (isEditMode) {
                // Á∑®ÈõÜ„É¢„Éº„Éâ‰∏≠
                editBtn.disabled = true;
                editBtn.style.backgroundColor = '#c8e6c9'; // ËñÑ„ÅÑ„Ç∞„É¨„ÉºÁ∑ë
                applyBtn.disabled = false;
                applyBtn.style.backgroundColor = '#66bb6a'; // ÈÄöÂ∏∏„ÅÆÁ∑ë
                clearBtn.disabled = false;
                clearBtn.style.backgroundColor = '#a5d6a7'; // ÈÄöÂ∏∏„ÅÆËñÑÁ∑ë
            } else {
                // Á∑®ÈõÜ„É¢„Éº„ÉâÂ§ñ
                editBtn.disabled = false;
                editBtn.style.backgroundColor = '#81c784'; // ÈÄöÂ∏∏„ÅÆÁ∑ë
                applyBtn.disabled = true;
                applyBtn.style.backgroundColor = '#e0e0e0'; // „Ç∞„É¨„Éº
                clearBtn.disabled = true;
                clearBtn.style.backgroundColor = '#e0e0e0'; // „Ç∞„É¨„Éº
            }
        }
        
        // Á∑®ÈõÜ„É¢„Éº„ÉâÈñãÂßã
        function enableEditMode() {
            if (isEditMode) return; // Êó¢„Å´Á∑®ÈõÜ„É¢„Éº„Éâ„ÅÆÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            
            isEditMode = true;
            const selects = document.querySelectorAll('#detailSettings select');
            const inputs = document.querySelectorAll('#detailSettings input[type="text"]');
            
            // „Çª„É¨„ÇØ„Éà„Éú„ÉÉ„ÇØ„Çπ„Å®ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÇíÊúâÂäπÂåñ
            selects.forEach(select => select.disabled = false);
            inputs.forEach(input => input.disabled = false);
            
            // „Éú„Çø„É≥Áä∂ÊÖã„ÇíÊõ¥Êñ∞
            updateButtonStates();
            
            console.log('Á∑®ÈõÜ„É¢„Éº„ÉâÈñãÂßã');
        }
        
        // Ë®≠ÂÆö„ÇíÂèçÊò†
        function applySettings() {
            if (!isEditMode) {
                console.log('Á∑®ÈõÜ„É¢„Éº„Éâ„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            // Ë®≠ÂÆöÂÄ§„Çí‰øùÂ≠òÔºàÂÆüÈöõ„ÅÆÂá¶ÁêÜ„ÅØ„Åì„Åì„Å´ÂÆüË£ÖÔºâ
            console.log('Ë®≠ÂÆö„ÇíÂèçÊò†„Åó„Åæ„Åó„Åü');
            
            // Á∑®ÈõÜ„É¢„Éº„Éâ„ÇíÁµÇ‰∫Ü
            exitEditMode();
        }
        
        // Á∑®ÈõÜ„É¢„Éº„ÉâÁµÇ‰∫Ü
        function exitEditMode() {
            isEditMode = false;
            const selects = document.querySelectorAll('#detailSettings select');
            const inputs = document.querySelectorAll('#detailSettings input[type="text"]');
            
            // „Çª„É¨„ÇØ„Éà„Éú„ÉÉ„ÇØ„Çπ„Å®ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÇíÁÑ°ÂäπÂåñ
            selects.forEach(select => select.disabled = true);
            inputs.forEach(input => input.disabled = true);
            
            // „Éú„Çø„É≥Áä∂ÊÖã„ÇíÊõ¥Êñ∞
            updateButtonStates();
            
            console.log('Á∑®ÈõÜ„É¢„Éº„ÉâÁµÇ‰∫Ü');
        }
        
        // „ÇØ„É™„Ç¢Ê©üËÉΩÔºà„ÇØ„Ç§„ÉÉ„ÇØË®≠ÂÆö„ÅÆÂÄ§„Å´Êàª„ÅôÔºâ
        function clearToPreset() {
            if (!isEditMode) {
                console.log('Á∑®ÈõÜ„É¢„Éº„Éâ„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            console.log('„ÇØ„Ç§„ÉÉ„ÇØË®≠ÂÆö„ÅÆÂÄ§„Å´„É™„Çª„ÉÉ„Éà');
            // ÁèæÂú®„ÅÆ„Éó„É™„Çª„ÉÉ„ÉàÂÄ§„ÇíÈÅ©Áî®
            applyPreset();
        }
        
        // „Éö„Éº„Ç∏„É≠„Éº„ÉâÊôÇ„Å´„Éá„Éï„Ç©„É´„Éà„Éó„É™„Çª„ÉÉ„Éà„ÇíÈÅ©Áî®
        window.addEventListener('DOMContentLoaded', function() {
            applyPreset();
            // ÂàùÊúü„Éú„Çø„É≥Áä∂ÊÖã„ÇíË®≠ÂÆö
            updateButtonStates();
        });
    </script>
</body>
</html>