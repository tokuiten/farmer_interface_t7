<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂèéÁ©´„É≠„Éú„ÉÉ„ÉàÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f1f8e9;
            height: 100vh;
            overflow: hidden;
        }

        .header {
            background: #81c784;
            color: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header .status {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .status-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .main-container {
            display: flex;
            height: calc(100vh - 70px);
        }

        .settings-panel {
            width: 60%;
            background: white;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .map-panel {
            width: 40%;
            padding: 10px 20px 20px 30px;
            overflow: hidden;
            position: relative;
            background: #f1f8e9;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Ë®≠ÂÆö„Éë„Éç„É´„ÅÆ„Çπ„Çø„Ç§„É´ */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .robot-controls {
            border: 2px solid #a5d6a7;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background-color: #f1f8e9;
        }
        
        .robot-row {
            display: flex;
            gap: 15px;
            align-items: end;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: inline-block;
            margin: 5px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 20px;
        }
        
        select, button {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 20px;
        }
        
        select:disabled {
            background-color: #f5f5f5;
            color: #666;
            cursor: not-allowed;
        }
        
        button {
            background-color: #66bb6a;
            color: white;
            cursor: pointer;
            margin-left: 10px;
        }
        
        button:hover:not(:disabled) {
            background-color: #4caf50;
        }
        
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        #animateBtn {
            background-color: #81c784;
        }
        
        #animateBtn:hover:not(:disabled) {
            background-color: #66bb6a;
        }
        
        #stopBtn {
            background-color: #a5d6a7;
        }
        
        #stopBtn:hover:not(:disabled) {
            background-color: #81c784;
        }
        
        .control-buttons {
            text-align: center;
            margin-top: 20px;
        }

        /* „Éó„É™„Çª„ÉÉ„Éà„Çª„É¨„ÇØ„Çø„ÅÆ„Çπ„Çø„Ç§„É´ */
        .preset-selector {
            background: #a5d6a7;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .preset-selector label {
            color: white;
            font-weight: bold;
            font-size: 20px;
            display: block;
            margin-bottom: 10px;
        }

        .preset-selector select {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 20px;
            background: white;
            min-width: 250px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* „Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥„ÅÆ„Çπ„Çø„Ç§„É´ */
        .accordion-toggle {
            background: #f1f8e9;
            border: 2px solid #81c784;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            margin-bottom: 15px;
            transition: all 0.3s;
            user-select: none;
        }

        .accordion-toggle:hover {
            background: #e8f5e8;
        }

        .accordion-toggle.active {
            background: #81c784;
            color: white;
        }

        .accordion-toggle .icon {
            font-size: 20px;
            margin-left: 10px;
            transition: transform 0.3s;
        }

        .accordion-toggle.active .icon {
            transform: rotate(180deg);
        }

        .accordion-content {
            display: none;
            animation: slideDown 0.3s ease-out;
        }

        .accordion-content.active {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 1000px;
            }
        }

        /* Á∞°Êòì„Ç≥„É≥„Éà„É≠„Éº„É´„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´ */
        .quick-controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }

        .quick-controls .control-buttons {
            margin-top: 0;
        }

        /* „Éû„ÉÉ„ÉóÁî®„ÅÆ„Ç≠„É£„É≥„Éê„Çπ„Çπ„Çø„Ç§„É´ */
        #canvas {
            border: 2px solid #333;
            background-color: white;
            max-width: 100%;
            max-height: 100%;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }

            .settings-panel {
                width: 100%;
                height: 50vh;
            }

            .map-panel {
                width: 100%;
                height: 50vh;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            <span>ü§ñ</span>
            ÂèéÁ©´„É≠„Éú„ÉÉ„ÉàÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†
        </h1>
        <div class="status">
            <div class="status-item">
                üìÖ <span id="current-date"></span>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="settings-panel">
            
            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: #e8f5e9; border-radius: 6px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="display: inline-block; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 10px solid #FF6B6B;"></span>
                            <span style="font-size: 20px;"><strong>T7L</strong>: Â∑¶Âêë„ÅçÂèéÁ©´„É≠„Éú</span>
                        </div>
                        <div id="robot1Status" style="background: rgba(165, 214, 167, 0.3); padding: 4px 12px; border-radius: 6px; font-size: 20px;">
                            <span id="robot1State">ÂÖÖÈõª‰∏≠</span>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: #e8f5e9; border-radius: 6px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="display: inline-block; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 10px solid #4A90E2;"></span>
                            <span style="font-size: 20px;"><strong>T7R</strong>: Âè≥Âêë„ÅçÂèéÁ©´„É≠„Éú</span>
                        </div>
                        <div id="robot2Status" style="background: rgba(165, 214, 167, 0.3); padding: 4px 12px; border-radius: 6px; font-size: 20px;">
                            <span id="robot2State">ÂæÖÊ©ü‰∏≠</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="preset-selector">
                <label for="presetSelect" style="font-size: 20px;">„ÇØ„Ç§„ÉÉ„ÇØË®≠ÂÆö</label>
                <div style="display: flex; align-items: center; gap: 15px; justify-content: center; margin-top: 10px;">
                    <select id="presetSelect">
                        <option value="two-robots">2Âè∞„ÅßÂÖ®Èù¢ÂèéÁ©´</option>
                        <option value="right-robot-only">T7R„ÅßÂÖ®Èù¢ÂèéÁ©´</option>
                        <option value="custom">„Ç´„Çπ„Çø„É†Ë®≠ÂÆö</option>
                    </select>
                    <button onclick="applyPreset()" style="background-color: #66bb6a; color: white; font-size: 20px; padding: 10px 20px;">Á¢∫ÂÆö</button>
                </div>
            </div>
            
            <div class="accordion-toggle" onclick="toggleAccordion()">
                <strong style="font-size: 20px;">Ë©≥Á¥∞Ë®≠ÂÆö</strong>
                <span class="icon">‚ñº</span>
            </div>
            
            <div class="accordion-content" id="detailSettings">
                <div class="control-buttons" style="margin-bottom: 20px; text-align: center;">
                    <button id="editBtn" onclick="enableEditMode()" style="background-color: #81c784; color: white; font-size: 20px; padding: 10px 20px; margin: 0 5px;">Á∑®ÈõÜ</button>
                    <button id="applyBtn" onclick="applySettings()" style="background-color: #66bb6a; color: white; font-size: 20px; padding: 10px 20px; margin: 0 5px;">ÂèçÊò†</button>
                    <button id="clearBtn" onclick="clearToPreset()" style="background-color: #a5d6a7; color: white; font-size: 20px; padding: 10px 20px; margin: 0 5px;">„ÇØ„É™„Ç¢</button>
                </div>
                <div class="controls">
                <div class="robot-controls">
                    <h3 style="font-size: 20px;"><span style="display: inline-block; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 10px solid #FF6B6B; margin-right: 8px; vertical-align: middle;"></span>T7L Ë®≠ÂÆö</h3>
                    <div class="robot-row">
                        <div class="control-group">
                            <label for="startArea1">ÈñãÂßã„Ç®„É™„Ç¢:</label>
                            <select id="startArea1" disabled>
                                <option value="1">„Ç®„É™„Ç¢1</option>
                                <option value="2">„Ç®„É™„Ç¢2</option>
                                <option value="3">„Ç®„É™„Ç¢3</option>
                                <option value="4">„Ç®„É™„Ç¢4</option>
                                <option value="5">„Ç®„É™„Ç¢5</option>
                                <option value="6">„Ç®„É™„Ç¢6</option>
                                <option value="7">„Ç®„É™„Ç¢7</option>
                                <option value="8">„Ç®„É™„Ç¢8</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label for="startLane1">ÈñãÂßãÈÄöË∑Ø:</label>
                            <select id="startLane1" disabled>
                                <option value="1">ÈÄöË∑Ø1</option>
                                <option value="2">ÈÄöË∑Ø2</option>
                                <option value="3">ÈÄöË∑Ø3</option>
                                <option value="4">ÈÄöË∑Ø4</option>
                                <option value="5">ÈÄöË∑Ø5</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label for="endArea1">ÁµÇ‰∫Ü„Ç®„É™„Ç¢:</label>
                            <select id="endArea1" disabled>
                                <option value="1">„Ç®„É™„Ç¢1</option>
                                <option value="2">„Ç®„É™„Ç¢2</option>
                                <option value="3">„Ç®„É™„Ç¢3</option>
                                <option value="4">„Ç®„É™„Ç¢4</option>
                                <option value="5" selected>„Ç®„É™„Ç¢5</option>
                                <option value="6">„Ç®„É™„Ç¢6</option>
                                <option value="7">„Ç®„É™„Ç¢7</option>
                                <option value="8">„Ç®„É™„Ç¢8</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label for="endLane1">ÁµÇ‰∫ÜÈÄöË∑Ø:</label>
                            <select id="endLane1" disabled>
                                <option value="1" selected>ÈÄöË∑Ø1</option>
                                <option value="2">ÈÄöË∑Ø2</option>
                                <option value="3">ÈÄöË∑Ø3</option>
                                <option value="4">ÈÄöË∑Ø4</option>
                                <option value="5">ÈÄöË∑Ø5</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label for="direction1">ÂõûËª¢ÊñπÂêë:</label>
                            <select id="direction1" disabled>
                                <option value="right">ÊôÇË®àÂõû„Çä</option>
                                <option value="left">ÂèçÊôÇË®àÂõû„Çä</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="robot-controls">
                    <h3 style="font-size: 20px;"><span style="display: inline-block; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 10px solid #4A90E2; margin-right: 8px; vertical-align: middle;"></span>T7R Ë®≠ÂÆö</h3>
                    <div class="robot-row">
                        <div class="control-group">
                            <label for="startArea2">ÈñãÂßã„Ç®„É™„Ç¢:</label>
                            <select id="startArea2" disabled>
                                <option value="1">„Ç®„É™„Ç¢1</option>
                                <option value="2">„Ç®„É™„Ç¢2</option>
                                <option value="3">„Ç®„É™„Ç¢3</option>
                                <option value="4">„Ç®„É™„Ç¢4</option>
                                <option value="5" selected>„Ç®„É™„Ç¢5</option>
                                <option value="6">„Ç®„É™„Ç¢6</option>
                                <option value="7">„Ç®„É™„Ç¢7</option>
                                <option value="8">„Ç®„É™„Ç¢8</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label for="startLane2">ÈñãÂßãÈÄöË∑Ø:</label>
                            <select id="startLane2" disabled>
                                <option value="1">ÈÄöË∑Ø1</option>
                                <option value="2">ÈÄöË∑Ø2</option>
                                <option value="3">ÈÄöË∑Ø3</option>
                                <option value="4">ÈÄöË∑Ø4</option>
                                <option value="5">ÈÄöË∑Ø5</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label for="endArea2">ÁµÇ‰∫Ü„Ç®„É™„Ç¢:</label>
                            <select id="endArea2" disabled>
                                <option value="1" selected>„Ç®„É™„Ç¢1</option>
                                <option value="2">„Ç®„É™„Ç¢2</option>
                                <option value="3">„Ç®„É™„Ç¢3</option>
                                <option value="4">„Ç®„É™„Ç¢4</option>
                                <option value="5">„Ç®„É™„Ç¢5</option>
                                <option value="6">„Ç®„É™„Ç¢6</option>
                                <option value="7">„Ç®„É™„Ç¢7</option>
                                <option value="8">„Ç®„É™„Ç¢8</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label for="endLane2">ÁµÇ‰∫ÜÈÄöË∑Ø:</label>
                            <select id="endLane2" disabled>
                                <option value="1" selected>ÈÄöË∑Ø1</option>
                                <option value="2">ÈÄöË∑Ø2</option>
                                <option value="3">ÈÄöË∑Ø3</option>
                                <option value="4">ÈÄöË∑Ø4</option>
                                <option value="5">ÈÄöË∑Ø5</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label for="direction2">ÂõûËª¢ÊñπÂêë:</label>
                            <select id="direction2" disabled>
                                <option value="right">ÊôÇË®àÂõû„Çä</option>
                                <option value="left" selected>ÂèçÊôÇË®àÂõû„Çä</option>
                            </select>
                        </div>
                    </div>
                </div>


                </div>
            </div>
            
            <div class="accordion-toggle" onclick="toggleLaneSettings()">
                <strong style="font-size: 20px;">ÂÖ•„ÇãÈÄöË∑Ø</strong>
                <span class="icon" id="laneIcon">‚ñº</span>
            </div>
            
            <div class="accordion-content" id="laneSettings">
                <div class="controls">
                    <!-- T7LË®≠ÂÆö -->
                    <div class="robot-controls">
                        <h3 style="font-size: 18px; cursor: pointer;" onclick="toggleRobotLanes('T7L')">
                            <span style="display: inline-block; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 10px solid #FF6B6B; margin-right: 8px; vertical-align: middle;"></span>
                            T7L ÈÄöË∑ØË®≠ÂÆö
                            <span class="icon" id="t7lIcon" style="margin-left: 10px;">‚ñº</span>
                        </h3>
                        <div class="accordion-content" id="t7lLanes">
                            <div class="controls" style="padding: 10px 0;">
                                <div id="t7lAreaControls"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- T7RË®≠ÂÆö -->
                    <div class="robot-controls">
                        <h3 style="font-size: 18px; cursor: pointer;" onclick="toggleRobotLanes('T7R')">
                            <span style="display: inline-block; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 10px solid #4A90E2; margin-right: 8px; vertical-align: middle;"></span>
                            T7R ÈÄöË∑ØË®≠ÂÆö
                            <span class="icon" id="t7rIcon" style="margin-left: 10px;">‚ñº</span>
                        </h3>
                        <div class="accordion-content" id="t7rLanes">
                            <div class="controls" style="padding: 10px 0;">
                                <div id="t7rAreaControls"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="accordion-toggle" onclick="togglePreviewSettings()">
                <strong style="font-size: 20px;">„Éó„É¨„Éì„É•„ÉºË®≠ÂÆö</strong>
                <span class="icon" id="previewIcon">‚ñº</span>
            </div>
            
            <div class="accordion-content" id="previewSettings">
                <div class="controls">
                    <div style="margin-bottom: 20px;">
                        <label for="speedSlider" style="font-size: 18px;">ÁßªÂãïÈÄüÂ∫¶ (ÂÖ®Âè∞ÂÖ±ÈÄö):</label>
                        <div style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">
                            <span style="font-size: 16px;">ÈÅÖ„ÅÑ</span>
                            <input type="range" id="speedSlider" min="0.5" max="5" value="2" step="0.5" style="flex: 1; height: 8px;">
                            <span style="font-size: 16px;">ÈÄü„ÅÑ</span>
                            <span id="speedValue" style="font-size: 16px; font-weight: bold; min-width: 40px;">2.0</span>
                        </div>
                    </div>
                    
                    <div class="robot-controls">
                        <h3 style="font-size: 18px;"><span style="display: inline-block; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 10px solid #FF6B6B; margin-right: 8px; vertical-align: middle;"></span>T7L ÈñãÂßã„Éá„Ç£„É¨„Ç§</h3>
                        <div style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">
                            <label for="delayT7L" style="font-size: 16px;">ÈÅÖÂª∂ÊôÇÈñì:</label>
                            <select id="delayT7L" style="font-size: 16px; padding: 4px 8px;">
                                <option value="0">0.0Áßí</option>
                                <option value="0.1">0.1Áßí</option>
                                <option value="0.2">0.2Áßí</option>
                                <option value="0.3">0.3Áßí</option>
                                <option value="0.4">0.4Áßí</option>
                                <option value="0.5">0.5Áßí</option>
                                <option value="0.6">0.6Áßí</option>
                                <option value="0.7">0.7Áßí</option>
                                <option value="0.8">0.8Áßí</option>
                                <option value="0.9">0.9Áßí</option>
                                <option value="1.0">1.0Áßí</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="robot-controls">
                        <h3 style="font-size: 18px;"><span style="display: inline-block; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 10px solid #4A90E2; margin-right: 8px; vertical-align: middle;"></span>T7R ÈñãÂßã„Éá„Ç£„É¨„Ç§</h3>
                        <div style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">
                            <label for="delayT7R" style="font-size: 16px;">ÈÅÖÂª∂ÊôÇÈñì:</label>
                            <select id="delayT7R" style="font-size: 16px; padding: 4px 8px;">
                                <option value="0">0.0Áßí</option>
                                <option value="0.1">0.1Áßí</option>
                                <option value="0.2">0.2Áßí</option>
                                <option value="0.3" selected>0.3Áßí</option>
                                <option value="0.4">0.4Áßí</option>
                                <option value="0.5">0.5Áßí</option>
                                <option value="0.6">0.6Áßí</option>
                                <option value="0.7">0.7Áßí</option>
                                <option value="0.8">0.8Áßí</option>
                                <option value="0.9">0.9Áßí</option>
                                <option value="1.0">1.0Áßí</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="quick-controls">
                <div class="control-buttons">
                    <button onclick="calculatePaths()" style="background-color: #66bb6a; font-size: 20px; padding: 12px 24px;">ÁµåË∑ØÁ¢∫Ë™ç</button>
                    <button id="animateBtn" onclick="startAnimation()" disabled style="background-color: #81c784; font-size: 20px; padding: 12px 24px;">ÈñãÂßã</button>
                    <button id="stopBtn" onclick="stopAnimation()" disabled style="background-color: #a5d6a7; font-size: 20px; padding: 12px 24px;">ÂÅúÊ≠¢</button>
                    <button onclick="clearPath()" style="background-color: #e0e0e0; font-size: 20px; padding: 12px 24px;">„ÇØ„É™„Ç¢</button>
                </div>
            </div>
        </div>

        <div class="map-panel">
            <canvas id="canvas"></canvas>
        </div>
    </div>

    <script>
        // ÁèæÂú®„ÅÆÊó•ÊôÇ„ÇíË°®Á§∫
        function updateDateTime() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('ja-JP', { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit' 
            });
            const timeStr = now.toLocaleTimeString('ja-JP', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            document.getElementById('current-date').textContent = `${dateStr} ${timeStr}`;
        }

        updateDateTime();
        setInterval(updateDateTime, 60000); // 1ÂàÜ„Åî„Å®„Å´Êõ¥Êñ∞
        
        // „É≠„Éú„ÉÉ„ÉàÁä∂ÊÖã„ÅÆÊõ¥Êñ∞
        function updateRobotStatus(robotId, status) {
            const statusElement = document.getElementById(`robot${robotId}State`);
            const statusItem = document.getElementById(`robot${robotId}Status`);
            
            // Áä∂ÊÖã„Å´Âøú„Åò„Åü„Ç¢„Ç§„Ç≥„É≥„ÇíË®≠ÂÆö
            let icon = '';
            switch(status) {
                case 'ÂÖÖÈõª‰∏≠':
                    icon = 'üîã ';
                    break;
                case 'ÂæÖÊ©ü‰∏≠':
                    icon = '‚è∏Ô∏è ';
                    break;
                case 'Á®ºÂÉç‰∏≠':
                    icon = 'üöú ';
                    break;
                case 'ÈÄö‰ø°‰∏çÂèØ':
                    icon = 'üìµ ';
                    break;
                default:
                    icon = '';
            }
            
            statusElement.textContent = icon + status;
        }
        
        // ÂàùÊúüÁä∂ÊÖã„ÇíË®≠ÂÆö
        updateRobotStatus(1, 'ÂÖÖÈõª‰∏≠');
        updateRobotStatus(2, 'ÂæÖÊ©ü‰∏≠');
        
        // „Éá„É¢Áî®: „É≠„Éú„ÉÉ„ÉàÁä∂ÊÖã„ÇíÂÆöÊúüÁöÑ„Å´Êõ¥Êñ∞
        setInterval(function() {
            const states = ['ÂÖÖÈõª‰∏≠', 'ÂæÖÊ©ü‰∏≠', 'Á®ºÂÉç‰∏≠', 'ÈÄö‰ø°‰∏çÂèØ'];
            const randomState1 = states[Math.floor(Math.random() * states.length)];
            const randomState2 = states[Math.floor(Math.random() * states.length)];
            // updateRobotStatus(1, randomState1);
            // updateRobotStatus(2, randomState2);
        }, 5000); // 5Áßí„Åî„Å®„Å´Êõ¥Êñ∞Ôºà„Éá„É¢Áî®„ÄÅÂÆüÈöõ„ÅØ„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„ÉàÔºâ

        // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Âà∂Âæ°Áî®Â§âÊï∞
        let animationId = null;
        let animationSpeed = 2; // „Éî„ÇØ„Çª„É´/„Éï„É¨„Éº„É†
        let robotStartDelays = {
            robot1: 0,    // T7L
            robot2: 0.3   // T7R („Éá„Éï„Ç©„É´„Éà0.3ÁßíÈÅÖÂª∂)
        };
        let delayTimeouts = {
            robot1: null,
            robot2: null
        };

        // „É≠„Éú„ÉÉ„Éà„ÅÆÁßªÂãïÁµåË∑Ø„ÇíË®àÁÆó
        function calculateRobotPath(robotId) {
            const startAreaId = `startArea${robotId}`;
            const endAreaId = `endArea${robotId}`;
            const startLaneId = `startLane${robotId}`;
            const endLaneId = `endLane${robotId}`;
            const directionId = `direction${robotId}`;
            
            const startArea = parseInt(document.getElementById(startAreaId).value);
            const endArea = parseInt(document.getElementById(endAreaId).value);
            const startLane = parseInt(document.getElementById(startLaneId).value);
            const endLane = parseInt(document.getElementById(endLaneId).value);
            const direction = document.getElementById(directionId).value;
            
            // ÁµåË∑Ø‰∏ä„ÅÆ„Ç®„É™„Ç¢„ÇíË®àÁÆó
            const sequence = areaSequences[direction];
            const startIndex = sequence.indexOf(startArea);
            const endIndex = sequence.indexOf(endArea);
            
            let pathAreas = [];
            if (startIndex <= endIndex) {
                pathAreas = sequence.slice(startIndex, endIndex + 1);
            } else {
                pathAreas = sequence.slice(startIndex).concat(sequence.slice(0, endIndex + 1));
            }
            
            return {
                areas: pathAreas,
                startLane,
                endLane,
                direction
            };
        }

        // „É≠„Éú„ÉÉ„Éà„ÇíÁßªÂãï„Åï„Åõ„Çã
        function moveRobot(robotId, targetX, targetY, targetAngle = null) {
            const robot = robotPositions[`robot${robotId}`];
            const dx = targetX - robot.x;
            const dy = targetY - robot.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            // „É≠„Éú„ÉÉ„Éà„ÅÆÂêë„Åç„ÇíÂõ∫ÂÆöÔºàT7L=Â∑¶Âêë„Åç„ÄÅT7R=Âè≥Âêë„ÅçÔºâ
            const fixedAngle = robotId === 1 ? 180 : 0; // T7L: 180Â∫¶ÔºàÂ∑¶Ôºâ, T7R: 0Â∫¶ÔºàÂè≥Ôºâ
            
            if (distance > animationSpeed) {
                // ÁõÆÊ®ô„Å´Âêë„Åã„Å£„Å¶ÁßªÂãï
                robot.x += (dx / distance) * animationSpeed;
                robot.y += (dy / distance) * animationSpeed;
                robot.angle = fixedAngle; // Âõ∫ÂÆö„ÅÆÂêë„Åç
                return false; // „Åæ„Å†Âà∞ÁùÄ„Åó„Å¶„ÅÑ„Å™„ÅÑ
            } else {
                // ÁõÆÊ®ô„Å´Âà∞ÁùÄ
                robot.x = targetX;
                robot.y = targetY;
                robot.angle = fixedAngle; // Âõ∫ÂÆö„ÅÆÂêë„Åç
                return true; // Âà∞ÁùÄ
            }
        }

        // ÁµÇ‰∫ÜÊù°‰ª∂„Çí„ÉÅ„Çß„ÉÉ„ÇØ
        function checkEndCondition(robotId, currentArea, currentLane, path) {
            return currentArea === path.endArea && currentLane === path.endLane;
        }

        // „É≠„Éú„ÉÉ„Éà„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
        function updateRobotMovement(robotId) {
            const state = robotStates[`robot${robotId}`];
            if (!state.isMoving || state.pathComplete) return;
            
            const path = calculateRobotPath(robotId);
            const startLaneX = getStartLaneX(robotId);
            
            // ÈñãÂßãÂú∞ÁÇπ„ÅÆÊ®™Â∫ßÊ®ô„Å´Âà∞ÈÅî„Åô„Çã„Åæ„ÅßÁõ¥ÈÄ≤
            if (!state.hasReachedStart) {
                const targetY = mapConstants.centralPathCenterY;
                const arrived = moveRobot(robotId, startLaneX, targetY);
                
                if (arrived) {
                    state.hasReachedStart = true;
                    state.currentAreaIndex = 0;
                    state.currentArea = path.areas[0];
                    // ÁèæÂú®„ÅÆ„Ç®„É™„Ç¢„ÅßÂÖ•„Çå„ÇãÈÄöË∑Ø„Çí„Åô„Åπ„Å¶ÂèñÂæó
                    const laneSequence = getLaneSequence(state.currentArea, path.direction);
                    state.availableLanes = laneSequence.filter(lane => canEnterLane(robotId, state.currentArea, lane));
                    state.currentLaneIndex = 0;
                }
                return;
            }
            
            if (!state.isInLane && !state.isMovingToNextArea) {
                // ÁèæÂú®„ÅÆ„Ç®„É™„Ç¢„ÅßÊ¨°„ÅÆÈÄöË∑Ø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                if (state.currentLaneIndex < state.availableLanes.length) {
                    const nextLane = state.availableLanes[state.currentLaneIndex];
                    const laneEntrance = getLaneEntrance(state.currentArea, nextLane);
                    
                    // ÈÄöË∑ØÂÖ•„ÇäÂè£„Å´ÁßªÂãï
                    const arrived = moveRobot(robotId, laneEntrance.x, laneEntrance.y);
                    if (arrived) {
                        state.isInLane = true;
                        state.currentLane = nextLane;
                        state.laneProgress = 0;
                    }
                } else {
                    // ÁèæÂú®„ÅÆ„Ç®„É™„Ç¢„ÅÆÂÖ®ÈÄöË∑ØÂÆå‰∫Ü„ÄÅÊ¨°„ÅÆ„Ç®„É™„Ç¢„Å∏
                    state.currentAreaIndex++;
                    
                    // ÁµÇ‰∫Ü„Ç®„É™„Ç¢„ÇíË∂Ö„Åà„ÅüÂ†¥Âêà„ÅØÂÆå‰∫Ü
                    if (state.currentAreaIndex >= path.areas.length) {
                        state.pathComplete = true;
                        state.isMoving = false;
                        updateRobotStatus(robotId, 'ÂæÖÊ©ü‰∏≠');
                        return;
                    }
                    
                    // Ê¨°„ÅÆ„Ç®„É™„Ç¢„Å´ÁßªÂãïÈñãÂßã
                    state.isMovingToNextArea = true;
                    state.currentArea = path.areas[state.currentAreaIndex];
                }
            } else if (state.isMovingToNextArea) {
                // ‰∏≠Â§ÆÈÄöË∑ØÁµåÁî±„ÅßÊ¨°„ÅÆ„Ç®„É™„Ç¢„Å´ÁßªÂãï‰∏≠
                const areaCoords = getAreaCoordinates(state.currentArea);
                const currentX = robotPositions[`robot${robotId}`].x;
                
                // „Ç®„É™„Ç¢„ÅÆÂ∑¶Á´Ø„Å®Âè≥Á´Ø„ÇíË®àÁÆó
                const areaLeftX = areaCoords.x;
                const areaRightX = areaCoords.x + mapConstants.areaWidth;
                
                // ÁèæÂú®‰ΩçÁΩÆ„Åã„Çâ„Ç®„É™„Ç¢„ÅÆÁ´Ø„Åæ„Åß„ÅÆË∑ùÈõ¢„ÇíË®àÁÆó
                const distanceToLeft = Math.abs(currentX - areaLeftX);
                const distanceToRight = Math.abs(currentX - areaRightX);
                
                // Ëøë„ÅÑÊñπ„ÅÆÁ´Ø„ÇíÁõÆÊ®ô„Å´„Åô„Çã
                const targetX = distanceToLeft < distanceToRight ? areaLeftX : areaRightX;
                const targetY = mapConstants.centralPathCenterY;
                
                const arrived = moveRobot(robotId, targetX, targetY);
                if (arrived) {
                    // Êñ∞„Åó„ÅÑ„Ç®„É™„Ç¢„ÅÆÁ´Ø„Å´Âà∞ÁùÄ
                    state.isMovingToNextArea = false;
                    // Êñ∞„Åó„ÅÑ„Ç®„É™„Ç¢„ÅßÂÖ•„Çå„ÇãÈÄöË∑Ø„Çí„Åô„Åπ„Å¶ÂèñÂæó
                    const laneSequence = getLaneSequence(state.currentArea, path.direction);
                    state.availableLanes = laneSequence.filter(lane => canEnterLane(robotId, state.currentArea, lane));
                    state.currentLaneIndex = 0;
                }
            } else {
                // ÈÄöË∑ØÂÜÖ„ÇíÁßªÂãï‰∏≠
                const laneEntrance = getLaneEntrance(state.currentArea, state.currentLane);
                const laneEnd = getLaneEnd(state.currentArea, state.currentLane);
                
                if (state.laneProgress === 0) {
                    // ÈÄöË∑ØÂ••„Å´Âêë„Åã„Å£„Å¶ÁßªÂãï
                    const arrived = moveRobot(robotId, laneEnd.x, laneEnd.y);
                    if (arrived) {
                        state.laneProgress = 1;
                    }
                } else {
                    // ‰∏≠Â§ÆÈÄöË∑Ø„Å´Êàª„Çã
                    const arrived = moveRobot(robotId, laneEntrance.x, laneEntrance.y);
                    if (arrived) {
                        // ÁµÇ‰∫ÜÊù°‰ª∂„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                        if (checkEndCondition(robotId, state.currentArea, state.currentLane, path)) {
                            // ÁµÇ‰∫Ü„Ç®„É™„Ç¢„ÉªÁµÇ‰∫ÜÈÄöË∑Ø„Åß„ÅÆ‰ΩúÊ•≠ÂÆå‰∫Ü
                            state.pathComplete = true;
                            state.isMoving = false;
                            updateRobotStatus(robotId, 'ÂæÖÊ©ü‰∏≠');
                            return;
                        }
                        
                        state.isInLane = false;
                        state.currentLaneIndex++;
                        state.laneProgress = 0;
                    }
                }
            }
        }

        // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„É´„Éº„Éó
        function animateRobots() {
            updateRobotMovement(1);
            updateRobotMovement(2);
            drawFarm();
            
            // ‰∏°Êñπ„ÅÆ„É≠„Éú„ÉÉ„Éà„ÅåÂÆå‰∫Ü„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØÁ∂öË°å
            if (robotStates.robot1.isMoving || robotStates.robot2.isMoving) {
                animationId = requestAnimationFrame(animateRobots);
            } else {
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁµÇ‰∫Ü
                document.getElementById('animateBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
                animationId = null;
            }
        }

        // „É≠„Éú„ÉÉ„ÉàË®≠ÂÆö„ÅÆÂü∫Êú¨Èñ¢Êï∞
        function calculatePaths() {
            console.log('ÁµåË∑ØË®àÁÆó„ÇíÂÆüË°å');
            
            // ‰∏°„É≠„Éú„ÉÉ„Éà„ÅÆÁµåË∑Ø„ÇíË®àÁÆó„Åó„Å¶„Ç≥„É≥„ÇΩ„Éº„É´„Å´Ë°®Á§∫
            const path1 = calculateRobotPath(1);
            const path2 = calculateRobotPath(2);
            
            console.log('T7LÁµåË∑Ø:', path1);
            console.log('T7RÁµåË∑Ø:', path2);
            
            document.getElementById('animateBtn').disabled = false;
        }

        function clearPath() {
            console.log('ÁµåË∑Ø„Çí„ÇØ„É™„Ç¢');
            
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÅúÊ≠¢
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            // „Éá„Ç£„É¨„Ç§„Çø„Ç§„Éû„Éº„Çí„ÇØ„É™„Ç¢
            if (delayTimeouts.robot1) {
                clearTimeout(delayTimeouts.robot1);
                delayTimeouts.robot1 = null;
            }
            if (delayTimeouts.robot2) {
                clearTimeout(delayTimeouts.robot2);
                delayTimeouts.robot2 = null;
            }
            
            // „É≠„Éú„ÉÉ„ÉàÁä∂ÊÖã„É™„Çª„ÉÉ„Éà
            robotStates.robot1.isMoving = false;
            robotStates.robot1.hasReachedStart = false;
            robotStates.robot1.pathComplete = false;
            robotStates.robot1.currentAreaIndex = 0;
            robotStates.robot1.currentLaneIndex = 0;
            robotStates.robot1.isInLane = false;
            robotStates.robot1.isMovingToNextArea = false;
            robotStates.robot1.availableLanes = [];
            
            robotStates.robot2.isMoving = false;
            robotStates.robot2.hasReachedStart = false;
            robotStates.robot2.pathComplete = false;
            robotStates.robot2.currentAreaIndex = 0;
            robotStates.robot2.currentLaneIndex = 0;
            robotStates.robot2.isInLane = false;
            robotStates.robot2.isMovingToNextArea = false;
            robotStates.robot2.availableLanes = [];
            
            // „É≠„Éú„ÉÉ„Éà‰ΩçÁΩÆ„É™„Çª„ÉÉ„ÉàÔºàÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥„Å´Êàª„ÅôÔºâ
            robotPositions.robot1 = { x: leftMargin - 40, y: topBottomMargin + farmHeight / 2 - 10, angle: 180 }; // T7L - Â∑¶Âêë„ÅçÂõ∫ÂÆö
            robotPositions.robot2 = { x: leftMargin - 20, y: topBottomMargin + farmHeight / 2 + 10, angle: 0 };   // T7R - Âè≥Âêë„ÅçÂõ∫ÂÆö
            
            // „É≠„Éú„ÉÉ„ÉàÁä∂ÊÖãÊõ¥Êñ∞
            updateRobotStatus(1, 'ÂÖÖÈõª‰∏≠');
            updateRobotStatus(2, 'ÂæÖÊ©ü‰∏≠');
            
            document.getElementById('animateBtn').disabled = true;
            document.getElementById('stopBtn').disabled = true;
            
            drawFarm();
        }

        function startAnimation() {
            console.log('„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈñãÂßã');
            
            // Ë®≠ÂÆö„ÇíÊõ¥Êñ∞
            updateSpeedValue();
            updateDelaySettings();
            
            document.getElementById('animateBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            
            // T7LÔºà„É≠„Éú„ÉÉ„Éà1Ôºâ„ÅÆÈñãÂßã
            delayTimeouts.robot1 = setTimeout(() => {
                robotStates.robot1.isMoving = true;
                robotStates.robot1.hasReachedStart = false;
                robotStates.robot1.pathComplete = false;
                robotStates.robot1.currentAreaIndex = 0;
                robotStates.robot1.currentLaneIndex = 0;
                robotStates.robot1.isInLane = false;
                robotStates.robot1.isMovingToNextArea = false;
                robotStates.robot1.availableLanes = [];
                updateRobotStatus(1, 'Á®ºÂÉç‰∏≠');
                delayTimeouts.robot1 = null;
            }, robotStartDelays.robot1 * 1000);
            
            // T7RÔºà„É≠„Éú„ÉÉ„Éà2Ôºâ„ÅÆÈñãÂßã
            delayTimeouts.robot2 = setTimeout(() => {
                robotStates.robot2.isMoving = true;
                robotStates.robot2.hasReachedStart = false;
                robotStates.robot2.pathComplete = false;
                robotStates.robot2.currentAreaIndex = 0;
                robotStates.robot2.currentLaneIndex = 0;
                robotStates.robot2.isInLane = false;
                robotStates.robot2.isMovingToNextArea = false;
                robotStates.robot2.availableLanes = [];
                updateRobotStatus(2, 'Á®ºÂÉç‰∏≠');
                delayTimeouts.robot2 = null;
            }, robotStartDelays.robot2 * 1000);
            
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈñãÂßã
            animationId = requestAnimationFrame(animateRobots);
        }

        function stopAnimation() {
            console.log('„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÅúÊ≠¢');
            
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            // „Éá„Ç£„É¨„Ç§„Çø„Ç§„Éû„Éº„Çí„ÇØ„É™„Ç¢
            if (delayTimeouts.robot1) {
                clearTimeout(delayTimeouts.robot1);
                delayTimeouts.robot1 = null;
            }
            if (delayTimeouts.robot2) {
                clearTimeout(delayTimeouts.robot2);
                delayTimeouts.robot2 = null;
            }
            
            // „É≠„Éú„ÉÉ„ÉàÁä∂ÊÖã„É™„Çª„ÉÉ„Éà
            robotStates.robot1.isMoving = false;
            robotStates.robot2.isMoving = false;
            
            updateRobotStatus(1, 'ÂæÖÊ©ü‰∏≠');
            updateRobotStatus(2, 'ÂæÖÊ©ü‰∏≠');
            
            document.getElementById('animateBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }

        // „Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥„ÅÆÈñãÈñâ
        function toggleAccordion() {
            const toggle = document.querySelector('.accordion-toggle');
            const content = document.getElementById('detailSettings');
            
            toggle.classList.toggle('active');
            content.classList.toggle('active');
        }

        // „Éó„É¨„Éì„É•„ÉºË®≠ÂÆö„ÅÆÈñãÈñâ
        function togglePreviewSettings() {
            const toggles = document.querySelectorAll('.accordion-toggle');
            const toggle = toggles[toggles.length - 1]; // ÊúÄÂæå„ÅÆ„Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥
            const content = document.getElementById('previewSettings');
            const icon = document.getElementById('previewIcon');
            
            if (toggle && content && icon) {
                toggle.classList.toggle('active');
                content.classList.toggle('active');
                
                if (content.classList.contains('active')) {
                    icon.textContent = '‚ñ≤';
                } else {
                    icon.textContent = '‚ñº';
                }
            }
        }

        // ÈÄüÂ∫¶„Çπ„É©„Ç§„ÉÄ„Éº„ÅÆÂÄ§Êõ¥Êñ∞
        function updateSpeedValue() {
            const slider = document.getElementById('speedSlider');
            const speedValue = document.getElementById('speedValue');
            const newSpeed = parseFloat(slider.value);
            
            speedValue.textContent = newSpeed.toFixed(1);
            animationSpeed = newSpeed;
        }

        // „Éá„Ç£„É¨„Ç§Ë®≠ÂÆö„ÅÆÊõ¥Êñ∞
        function updateDelaySettings() {
            const delayT7L = parseFloat(document.getElementById('delayT7L').value);
            const delayT7R = parseFloat(document.getElementById('delayT7R').value);
            
            robotStartDelays.robot1 = delayT7L;
            robotStartDelays.robot2 = delayT7R;
        }

        // ÈÄöË∑ØË®≠ÂÆö„ÅÆ„Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥Âà∂Âæ°
        function toggleLaneSettings() {
            const toggles = document.querySelectorAll('.accordion-toggle');
            let toggle = null;
            
            // „ÄåÂÖ•„ÇãÈÄöË∑Ø„Äç„ÅÆ„Éà„Ç∞„É´„ÇíÊ§úÁ¥¢
            toggles.forEach(t => {
                if (t.textContent.includes('ÂÖ•„ÇãÈÄöË∑Ø')) {
                    toggle = t;
                }
            });
            
            const content = document.getElementById('laneSettings');
            const icon = document.getElementById('laneIcon');
            
            if (toggle && content && icon) {
                toggle.classList.toggle('active');
                content.classList.toggle('active');
                
                if (content.classList.contains('active')) {
                    icon.textContent = '‚ñ≤';
                } else {
                    icon.textContent = '‚ñº';
                }
            }
        }

        // „É≠„Éú„ÉÉ„ÉàÂà•ÈÄöË∑ØË®≠ÂÆö„ÅÆ„Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥Âà∂Âæ°
        function toggleRobotLanes(robotName) {
            const content = document.getElementById(robotName.toLowerCase() + 'Lanes');
            const icon = document.getElementById(robotName.toLowerCase() + 'Icon');
            
            if (content && icon) {
                content.classList.toggle('active');
                
                if (content.classList.contains('active')) {
                    icon.textContent = '‚ñ≤';
                } else {
                    icon.textContent = '‚ñº';
                }
            }
        }

        // „Ç®„É™„Ç¢Âà•ÈÄöË∑ØË®≠ÂÆö„ÅÆ„Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥Âà∂Âæ°
        function toggleAreaLanes(robotName, areaNum) {
            const content = document.getElementById(`${robotName.toLowerCase()}Area${areaNum}Lanes`);
            const icon = document.getElementById(`${robotName.toLowerCase()}Area${areaNum}Icon`);
            
            if (content && icon) {
                content.classList.toggle('active');
                
                if (content.classList.contains('active')) {
                    icon.textContent = '‚ñ≤';
                } else {
                    icon.textContent = '‚ñº';
                }
            }
        }

        // ÈÄöË∑Ø„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„ÇπÊßãÈÄ†„ÇíÂãïÁöÑÁîüÊàê
        function createLaneCheckboxes() {
            const robots = ['T7L', 'T7R'];
            
            robots.forEach(robotName => {
                const container = document.getElementById(`${robotName.toLowerCase()}AreaControls`);
                
                for (let area = 1; area <= 8; area++) {
                    // „Ç®„É™„Ç¢„ÅÆÊäò„Çä„Åü„Åü„Åø
                    const areaDiv = document.createElement('div');
                    areaDiv.className = 'robot-controls';
                    areaDiv.style.marginBottom = '15px';
                    
                    // „Ç®„É™„Ç¢„Éò„ÉÉ„ÉÄ„Éº
                    const areaHeader = document.createElement('h4');
                    areaHeader.style.fontSize = '16px';
                    areaHeader.style.cursor = 'pointer';
                    areaHeader.style.padding = '8px 12px';
                    areaHeader.style.backgroundColor = '#f5f5f5';
                    areaHeader.style.borderRadius = '4px';
                    areaHeader.style.margin = '0 0 8px 0';
                    areaHeader.onclick = () => toggleAreaLanes(robotName, area);
                    
                    // „Ç®„É™„Ç¢„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ
                    const areaCheckbox = document.createElement('input');
                    areaCheckbox.type = 'checkbox';
                    areaCheckbox.id = `${robotName.toLowerCase()}Area${area}Check`;
                    areaCheckbox.checked = true;
                    areaCheckbox.style.marginRight = '8px';
                    
                    areaHeader.appendChild(areaCheckbox);
                    areaHeader.appendChild(document.createTextNode(`„Ç®„É™„Ç¢${area}`));
                    
                    const areaIcon = document.createElement('span');
                    areaIcon.className = 'icon';
                    areaIcon.id = `${robotName.toLowerCase()}Area${area}Icon`;
                    areaIcon.textContent = '‚ñº';
                    areaIcon.style.marginLeft = '10px';
                    areaHeader.appendChild(areaIcon);
                    
                    // ÈÄöË∑ØË®≠ÂÆö„Ç≥„É≥„ÉÜ„É≥„ÉÑ
                    const laneContent = document.createElement('div');
                    laneContent.className = 'accordion-content';
                    laneContent.id = `${robotName.toLowerCase()}Area${area}Lanes`;
                    laneContent.style.padding = '10px';
                    laneContent.style.backgroundColor = '#fafafa';
                    laneContent.style.borderRadius = '4px';
                    
                    // ÈÄöË∑Ø1-5„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ
                    const laneGrid = document.createElement('div');
                    laneGrid.style.display = 'grid';
                    laneGrid.style.gridTemplateColumns = 'repeat(5, 1fr)';
                    laneGrid.style.gap = '10px';
                    
                    for (let lane = 1; lane <= 5; lane++) {
                        const laneLabel = document.createElement('label');
                        laneLabel.style.fontSize = '14px';
                        laneLabel.style.display = 'flex';
                        laneLabel.style.alignItems = 'center';
                        laneLabel.style.gap = '4px';
                        
                        const laneCheckbox = document.createElement('input');
                        laneCheckbox.type = 'checkbox';
                        laneCheckbox.id = `${robotName.toLowerCase()}Area${area}Lane${lane}`;
                        laneCheckbox.checked = true;
                        
                        laneLabel.appendChild(laneCheckbox);
                        laneLabel.appendChild(document.createTextNode(`ÈÄöË∑Ø${lane}`));
                        
                        laneGrid.appendChild(laneLabel);
                    }
                    
                    laneContent.appendChild(laneGrid);
                    
                    areaDiv.appendChild(areaHeader);
                    areaDiv.appendChild(laneContent);
                    container.appendChild(areaDiv);
                }
            });
        }

        // „Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆö
        function applyPreset() {
            const presetSelect = document.getElementById('presetSelect');
            const selectedPreset = presetSelect.value;
            
            // ‰∏ÄÊôÇÁöÑ„Å´selectË¶ÅÁ¥†„ÇíÊúâÂäπÂåñ„Åó„Å¶„Åã„ÇâË®≠ÂÆö
            const selects = document.querySelectorAll('#detailSettings select');
            const wasDisabled = [];
            
            // ÁèæÂú®„ÅÆÁä∂ÊÖã„ÇíË®òÈå≤„Åó„ÄÅ‰∏ÄÊôÇÁöÑ„Å´ÊúâÂäπÂåñ
            selects.forEach((select, index) => {
                wasDisabled[index] = select.disabled;
                select.disabled = false;
            });
            
            if (selectedPreset === 'two-robots') {
                // 2Âè∞„ÅßÂÖ®Èù¢ÂèéÁ©´Ôºà„Éá„Éï„Ç©„É´„ÉàË®≠ÂÆöÔºâ
                // T7L: „Ç®„É™„Ç¢1„Åã„Çâ5„ÇíÊãÖÂΩì„ÄÅ„Ç®„É™„Ç¢5„ÅÆÈÄöË∑Ø1„ÅßÁµÇ‰∫Ü
                document.getElementById('startArea1').value = '1';
                document.getElementById('startLane1').value = '1';
                document.getElementById('endArea1').value = '5';
                document.getElementById('endLane1').value = '1';
                document.getElementById('direction1').value = 'right';
                
                // T7R: „Ç®„É™„Ç¢5„Åã„Çâ1„ÇíÊãÖÂΩì„ÄÅ„Ç®„É™„Ç¢1„ÅÆÈÄöË∑Ø1„ÅßÁµÇ‰∫Ü
                document.getElementById('startArea2').value = '5';
                document.getElementById('startLane2').value = '1';
                document.getElementById('endArea2').value = '1';
                document.getElementById('endLane2').value = '1';
                document.getElementById('direction2').value = 'left';
            } else if (selectedPreset === 'right-robot-only') {
                // T7R„ÅßÂÖ®Èù¢ÂèéÁ©´
                // T7L: ÁÑ°ÂäπÂåñÔºàÂêå„Åò‰ΩçÁΩÆ„Å´Ë®≠ÂÆöÔºâ
                document.getElementById('startArea1').value = '1';
                document.getElementById('startLane1').value = '1';
                document.getElementById('endArea1').value = '1';
                document.getElementById('endLane1').value = '1';
                document.getElementById('direction1').value = 'right';
                
                // T7R: ÂÖ®„Ç®„É™„Ç¢„ÇíÊãÖÂΩì
                document.getElementById('startArea2').value = '1';
                document.getElementById('startLane2').value = '1';
                document.getElementById('endArea2').value = '8';
                document.getElementById('endLane2').value = '5';
                document.getElementById('direction2').value = 'left';
            }
            // „Ç´„Çπ„Çø„É†„ÅÆÂ†¥Âêà„ÅØÁèæÂú®„ÅÆË®≠ÂÆö„ÇíÁ∂≠ÊåÅ
            
            // ÂÖÉ„ÅÆÁä∂ÊÖã„Å´Êàª„Åô
            selects.forEach((select, index) => {
                select.disabled = wasDisabled[index];
            });
            
            console.log('„Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆö„ÇíÈÅ©Áî®:', selectedPreset);
        }

        // „Éû„ÉÉ„ÉóÊèèÁîª
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // „Çπ„Ç±„Éº„É´Ë®≠ÂÆöÔºà1m = 10px - „Ç≥„É≥„Éë„ÇØ„Éà„Å´Ë°®Á§∫Ôºâ
        const scale = 10;
        const farmWidth = 32 * scale; // 320px
        const farmHeight = 62.5 * scale; // 625px
        const centralPathWidth = 2.5 * scale; // 25px
        const ridgeWidth = 0.6 * scale; // 6px
        const ridgeLength = 30 * scale; // 300px
        const pathWidth = 1 * scale; // 10px
        const pillarSize = 0.3 * scale; // 3px
        const areaWidth = 8 * scale; // 80px
        
        // „Éû„Éº„Ç∏„É≥„ÇíËøΩÂä†ÔºàÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥ÂàÜ„ÇÇËÄÉÊÖÆÔºâ
        const leftMargin = 65; // ÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥Áî®„ÅÆÂπÖ„ÅÑ‰ΩôÁôΩ
        const rightMargin = 15; // Âè≥ÂÅ¥„ÅÆÁ¥∞„ÅÑ‰ΩôÁôΩ
        const topBottomMargin = 15; // ‰∏ä‰∏ã„ÅÆ‰ΩôÁôΩ
        canvas.width = farmWidth + leftMargin + rightMargin;
        canvas.height = farmHeight + topBottomMargin * 2;
        
        // Ëâ≤„ÅÆÂÆöÁæ©
        const colors = {
            ridge: '#90EE90',        // ÈªÑÁ∑ëËâ≤
            centralPath: '#F5F5F5',  // ÈùûÂ∏∏„Å´ËñÑ„ÅÑ„Ç∞„É¨„ÉºÔºà„Åª„ÅºÁôΩÔºâ
            pathBetween: '#FFFFFF',  // ÁôΩËâ≤ÔºàÁïùÈñìÈÄöË∑ØÔºâ
            pillar: '#666666',       // ÊøÉ„ÅÑ„Ç∞„É¨„Éº
            border: '#333333',       // Èªí
            background: '#FFFFFF',   // ÁôΩ
            text: '#000000',         // ÈªíÔºà„ÉÜ„Ç≠„Çπ„ÉàÁî®Ôºâ
            chargingStation: '#FFFFFF', // ÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥ÔºàÁôΩËâ≤Ôºâ
            robot1: '#FF6B6B',       // T7LÔºàËµ§Ëâ≤Ôºâ
            robot2: '#4A90E2'        // T7RÔºàÈùíËâ≤Ôºâ
        };
        
        // „É≠„Éú„ÉÉ„Éà„ÅÆ‰ΩçÁΩÆÊÉÖÂ†±ÔºàÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥ÂÜÖÔºâ
        let robotPositions = {
            robot1: { x: leftMargin - 40, y: topBottomMargin + farmHeight / 2 - 10, angle: 180 }, // T7L - Â∑¶Âêë„ÅçÂõ∫ÂÆö
            robot2: { x: leftMargin - 20, y: topBottomMargin + farmHeight / 2 + 10, angle: 0 }   // T7R - Âè≥Âêë„ÅçÂõ∫ÂÆö
        };
        
        function drawFarm() {
            // ËÉåÊôØ„Çí„ÇØ„É™„Ç¢
            ctx.fillStyle = colors.background;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Ëæ≤Â†¥ÂÖ®‰Ωì„ÇíËå∂Ëâ≤„ÅßÂ°ó„Çä„Å§„Å∂„ÅôÔºàÈÄöË∑Ø„ÅÆ„Éô„Éº„ÇπÔºâ
            ctx.fillStyle = colors.pathBetween;
            ctx.fillRect(leftMargin, topBottomMargin, farmWidth, farmHeight);
            
            // Êù±Ë•ø‰∏≠Â§ÆÈÄöË∑Ø„ÇíÊèèÁîª
            const centralPathY = topBottomMargin + (farmHeight - centralPathWidth) / 2;
            ctx.fillStyle = colors.centralPath;
            ctx.fillRect(leftMargin, centralPathY, farmWidth, centralPathWidth);
            
            // „Ç®„É™„Ç¢„Å®Áïù„ÇíÊèèÁîª
            for (let i = 0; i < 8; i++) {
                const row = i < 4 ? 0 : 1;
                const col = i % 4;
                const areaX = leftMargin + col * areaWidth;
                let areaY;
                
                if (row === 0) {
                    // ÂåóÂÅ¥„Ç®„É™„Ç¢Ôºà1-4Ôºâ
                    areaY = topBottomMargin;
                } else {
                    // ÂçóÂÅ¥„Ç®„É™„Ç¢Ôºà5-8Ôºâ- ‰∏≠Â§ÆÈÄöË∑Ø„Å´Áõ¥Êé•Êé•Á∂ö
                    areaY = centralPathY + centralPathWidth;
                }
                
                // Áïù„ÇíÊèèÁîª
                for (let j = 0; j < 4; j++) {
                    const ridgeX = areaX + pathWidth + j * (ridgeWidth + pathWidth);
                    let ridgeY, adjustedRidgeLength;
                    
                    if (row === 0) {
                        // ÂåóÂÅ¥„Ç®„É™„Ç¢ - ‰∏äÁ´Ø„Åã„Çâ‰∏≠Â§ÆÈÄöË∑Ø„Åæ„Åß
                        ridgeY = areaY + pathWidth;
                        adjustedRidgeLength = centralPathY - ridgeY;
                    } else {
                        // ÂçóÂÅ¥„Ç®„É™„Ç¢ - ‰∏≠Â§ÆÈÄöË∑Ø„Åã„Çâ‰∏ãÁ´Ø„Åæ„Åß
                        ridgeY = centralPathY + centralPathWidth;
                        adjustedRidgeLength = (topBottomMargin + farmHeight) - ridgeY - pathWidth;
                    }
                    
                    ctx.fillStyle = colors.ridge;
                    ctx.fillRect(ridgeX, ridgeY, ridgeWidth, adjustedRidgeLength);
                }
            }
            
            // Êü±„ÇíÊèèÁîª
            ctx.fillStyle = colors.pillar;
            for (let i = 0; i <= 4; i++) {
                for (let j = 0; j <= 25; j++) {
                    const x = leftMargin + i * areaWidth;
                    const y = topBottomMargin + j * 2.5 * scale;
                    ctx.fillRect(x - pillarSize / 2, y - pillarSize / 2, pillarSize, pillarSize);
                }
            }
            
            // Ëæ≤Â†¥„ÅÆÂ§ñÊû†
            ctx.strokeStyle = colors.border;
            ctx.lineWidth = 2;
            ctx.strokeRect(leftMargin, topBottomMargin, farmWidth, farmHeight);
            
            // ÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥„ÇíÊèèÁîªÔºàË•øÂÅ¥„ÄÅ‰∏≠Â§ÆÈÄöË∑Ø„ÅÆÂ∑¶Á´Ø„Å´Êé•„Åó„Å¶Ôºâ
            const chargingStationSize = 60; // 2ÂÄç„ÅÆ„Çµ„Ç§„Ç∫
            const chargingStationX = leftMargin - chargingStationSize; // Âè≥Á´Ø„Åå‰∏≠Â§ÆÈÄöË∑Ø„ÅÆÂ∑¶Á´Ø„Å´Êé•„Åô„Çã
            const chargingStationY = centralPathY + (centralPathWidth - chargingStationSize) / 2;
            
            // ÂÖÖÈõªÂ†¥ÊâÄ„ÅÆ„É©„Éô„É´Ôºà‰∏ä„Å´Ë°®Á§∫Ôºâ
            ctx.fillStyle = colors.text;
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ÂÖÖÈõªÂ†¥ÊâÄ', chargingStationX + chargingStationSize / 2, chargingStationY - 5);
            
            // ÂÖÖÈõª„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥Êú¨‰Ωì
            ctx.fillStyle = colors.chargingStation;
            ctx.fillRect(chargingStationX, chargingStationY, chargingStationSize, chargingStationSize);
            ctx.strokeStyle = colors.border;
            ctx.lineWidth = 2;
            ctx.strokeRect(chargingStationX, chargingStationY, chargingStationSize, chargingStationSize);
            
            // „Ç®„É™„Ç¢Áï™Âè∑„ÇíÊúÄÂâçÈù¢„Å´Ë°®Á§∫ÔºàÂêÑ„Ç®„É™„Ç¢„ÅÆÂçóÂåóÊñπÂêë„ÅÆ‰∏≠Â§ÆÔºâ
            ctx.fillStyle = colors.text;
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'left';
            for (let i = 0; i < 8; i++) {
                const row = i < 4 ? 0 : 1;
                const col = i % 4;
                const areaX = leftMargin + col * areaWidth + areaWidth / 2 - 20;
                let textY;
                
                if (row === 0) {
                    // ÂåóÂÅ¥„Ç®„É™„Ç¢Ôºà1-4Ôºâ- ÂåóÁ´Ø„Åã„Çâ‰∏≠Â§ÆÈÄöË∑Ø„Åæ„Åß„ÅÆ‰∏≠Â§Æ
                    const areaTop = topBottomMargin;
                    const areaBottom = centralPathY;
                    textY = (areaTop + areaBottom) / 2 + 3;
                } else {
                    // ÂçóÂÅ¥„Ç®„É™„Ç¢Ôºà5-8Ôºâ- ‰∏≠Â§ÆÈÄöË∑Ø„Åã„ÇâÂçóÁ´Ø„Åæ„Åß„ÅÆ‰∏≠Â§Æ
                    const areaTop = centralPathY + centralPathWidth;
                    const areaBottom = topBottomMargin + farmHeight;
                    textY = (areaTop + areaBottom) / 2 + 3;
                }
                
                ctx.fillText(`„Ç®„É™„Ç¢${i + 1}`, areaX, textY);
            }
            
            // „É≠„Éú„ÉÉ„Éà„ÇíÊèèÁîª
            drawRobot(1, robotPositions.robot1.x, robotPositions.robot1.y, robotPositions.robot1.angle, colors.robot1);
            drawRobot(2, robotPositions.robot2.x, robotPositions.robot2.y, robotPositions.robot2.angle, colors.robot2);
        }
        
        // „É≠„Éú„ÉÉ„Éà„Çí‰∫åÁ≠âËæ∫‰∏âËßíÂΩ¢„ÅßÊèèÁîª
        function drawRobot(robotId, x, y, angle, color) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle * Math.PI / 180);
            
            // ‰∫åÁ≠âËæ∫‰∏âËßíÂΩ¢„ÅÆ„Çµ„Ç§„Ç∫
            const size = 8;
            
            ctx.beginPath();
            ctx.moveTo(size, 0);           // ÂÖàÁ´ØÔºàÈÄ≤Ë°åÊñπÂêëÔºâ
            ctx.lineTo(-size/2, -size/2);  // Â∑¶‰∏ã
            ctx.lineTo(-size/2, size/2);   // Â∑¶‰∏ä
            ctx.closePath();
            
            ctx.fillStyle = color;
            ctx.fill();
            ctx.strokeStyle = colors.border;
            ctx.lineWidth = 1;
            ctx.stroke();
            
            
            ctx.restore();
        }
        
        // „É≠„Éú„ÉÉ„Éà„ÅÆÁßªÂãïÁä∂ÊÖãÁÆ°ÁêÜ
        let robotStates = {
            robot1: {
                isMoving: false,
                hasReachedStart: false,
                currentArea: 0,
                currentAreaIndex: 0,
                currentLane: 0,
                currentLaneIndex: 0,
                isInLane: false,
                isMovingToNextArea: false,
                direction: 'right',
                pathComplete: false,
                availableLanes: []
            },
            robot2: {
                isMoving: false,
                hasReachedStart: false,
                currentArea: 0,
                currentAreaIndex: 0,
                currentLane: 0,
                currentLaneIndex: 0,
                isInLane: false,
                isMovingToNextArea: false,
                direction: 'left',
                pathComplete: false,
                availableLanes: []
            }
        };

        // „Ç®„É™„Ç¢Â∑°ÂõûÈ†ÜÂ∫è„ÅÆÂÆöÁæ©
        const areaSequences = {
            right: [1, 2, 3, 4, 8, 7, 6, 5], // ÊôÇË®àÂõû„Çä
            left: [5, 6, 7, 8, 4, 3, 2, 1]   // ÂèçÊôÇË®àÂõû„Çä
        };

        // Â∫ßÊ®ôË®àÁÆóÁî®„ÅÆÂÆöÊï∞
        const mapConstants = {
            leftMargin: 65,
            topBottomMargin: 15,
            areaWidth: 8 * scale,
            centralPathY: topBottomMargin + (farmHeight - centralPathWidth) / 2,
            centralPathCenterY: topBottomMargin + farmHeight / 2,
            laneSpacing: (0.6 * scale + 1 * scale), // ÁïùÂπÖ + ÈÄöË∑ØÂπÖ
            laneStartOffset: 1 * scale // ÊúÄÂàù„ÅÆÈÄöË∑Ø„Åæ„Åß„ÅÆ„Ç™„Éï„Çª„ÉÉ„Éà
        };

        // „Ç®„É™„Ç¢Â∫ßÊ®ô„ÇíÂèñÂæó
        function getAreaCoordinates(areaNumber) {
            const row = areaNumber <= 4 ? 0 : 1;
            const col = (areaNumber - 1) % 4;
            const x = leftMargin + col * mapConstants.areaWidth;
            let y;
            
            if (row === 0) {
                // ÂåóÂÅ¥„Ç®„É™„Ç¢
                y = topBottomMargin;
            } else {
                // ÂçóÂÅ¥„Ç®„É™„Ç¢
                y = mapConstants.centralPathY + centralPathWidth;
            }
            
            return { x, y, row, col };
        }

        // ÈÄöË∑ØÂ∫ßÊ®ô„ÇíÂèñÂæóÔºà‰∏≠Â§ÆÈÄöË∑Ø„Åã„Çâ„ÅÆÂÖ•„ÇäÂè£Ôºâ- Áïù„Å®Áïù„ÅÆÈñì„ÅÆ‰∏≠Â§Æ
        function getLaneEntrance(areaNumber, laneNumber) {
            const areaCoords = getAreaCoordinates(areaNumber);
            let laneX;
            
            if (laneNumber === 1) {
                // ÈÄöË∑Ø1: „Ç®„É™„Ç¢Â∑¶Á´Ø„Åã„ÇâÊúÄÂàù„ÅÆÁïù„ÅÆÂè≥Á´Ø„Åæ„Åß‰∏≠Â§Æ
                laneX = areaCoords.x + mapConstants.laneStartOffset / 2;
            } else if (laneNumber === 5) {
                // ÈÄöË∑Ø5: ÊúÄÂæå„ÅÆÁïù„ÅÆÂ∑¶Á´Ø„Åã„Çâ„Ç®„É™„Ç¢Âè≥Á´Ø„Åæ„Åß‰∏≠Â§Æ
                const lastRidgeEnd = areaCoords.x + mapConstants.laneStartOffset + 3 * mapConstants.laneSpacing + (0.6 * scale);
                const areaEnd = areaCoords.x + mapConstants.areaWidth;
                laneX = lastRidgeEnd + (areaEnd - lastRidgeEnd) / 2;
            } else {
                // ÈÄöË∑Ø2-4: Áïù„Å®Áïù„ÅÆÈñì„ÅÆ‰∏≠Â§Æ
                const prevRidgeEnd = areaCoords.x + mapConstants.laneStartOffset + (laneNumber - 2) * mapConstants.laneSpacing + (0.6 * scale);
                const nextRidgeStart = areaCoords.x + mapConstants.laneStartOffset + (laneNumber - 1) * mapConstants.laneSpacing;
                laneX = (prevRidgeEnd + nextRidgeStart) / 2;
            }
            
            return {
                x: laneX,
                y: mapConstants.centralPathCenterY
            };
        }

        // ÈÄöË∑ØÂÜÖ„ÅÆÁµÇÁ´ØÂ∫ßÊ®ô„ÇíÂèñÂæó
        function getLaneEnd(areaNumber, laneNumber) {
            const laneEntrance = getLaneEntrance(areaNumber, laneNumber);
            let endY;
            
            if (areaNumber <= 4) {
                // ÂåóÂÅ¥„Ç®„É™„Ç¢ - ‰∏äÁ´Ø
                endY = topBottomMargin + pathWidth;
            } else {
                // ÂçóÂÅ¥„Ç®„É™„Ç¢ - ‰∏ãÁ´Ø
                endY = topBottomMargin + farmHeight - pathWidth;
            }
            
            return { x: laneEntrance.x, y: endY };
        }

        // „É≠„Éú„ÉÉ„Éà„ÅåÈÄ≤ÂÖ•ÂèØËÉΩ„Å™ÈÄöË∑Ø„Åã„Å©„ÅÜ„ÅãÂà§ÂÆöÔºàÁïù„ÅÆ‰ΩçÁΩÆÂü∫Ê∫ñ + „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„ÇπÔºâ
        function canEnterLane(robotId, areaNumber, laneNumber) {
            const isT7L = robotId === 1;
            const robotName = isT7L ? 'T7L' : 'T7R';
            
            // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÅÆÁä∂ÊÖã„ÇíÁ¢∫Ë™ç
            const areaCheckbox = document.getElementById(`${robotName.toLowerCase()}Area${areaNumber}Check`);
            const laneCheckbox = document.getElementById(`${robotName.toLowerCase()}Area${areaNumber}Lane${laneNumber}`);
            
            // „Ç®„É™„Ç¢„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Ååfalse„ÅÆÂ†¥Âêà„ÄÅ„Åù„ÅÆ„Ç®„É™„Ç¢„Åß„ÅØÈÄöË∑Ø„Å´ÂÖ•„Çâ„Å™„ÅÑ
            if (areaCheckbox && !areaCheckbox.checked) {
                return false;
            }
            
            // ÈÄöË∑Ø„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„Ååfalse„ÅÆÂ†¥Âêà„ÄÅ„Åù„ÅÆÈÄöË∑Ø„Å´„ÅØÂÖ•„Çâ„Å™„ÅÑ
            if (laneCheckbox && !laneCheckbox.checked) {
                return false;
            }
            
            // Áâ©ÁêÜÁöÑ„Å™Âà∂Á¥Ñ„ÉÅ„Çß„ÉÉ„ÇØÔºàÁïù„ÅÆ‰ΩçÁΩÆÂü∫Ê∫ñÔºâ
            // Â∑¶ÂÅ¥„Å´Áïù„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÈÄöË∑Ø1„ÅÆÂ†¥Âêà„ÅØÂ∑¶ÂÅ¥„Å´Áïù„Åå„Å™„ÅÑÔºâ
            const hasLeftRidge = laneNumber > 1;
            // Âè≥ÂÅ¥„Å´Áïù„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÈÄöË∑Ø5„ÅÆÂ†¥Âêà„ÅØÂè≥ÂÅ¥„Å´Áïù„Åå„Å™„ÅÑÔºâ
            const hasRightRidge = laneNumber < 5;
            
            if (isT7L) {
                // T7L: ÈÄöË∑Ø„ÅÆÂ∑¶ÂÅ¥„Å´Áïù„Åå„ÅÇ„ÇãÂ†¥Âêà„Å´ÂÖ•„Çå„Çã
                return hasLeftRidge;
            } else {
                // T7R: ÈÄöË∑Ø„ÅÆÂè≥ÂÅ¥„Å´Áïù„Åå„ÅÇ„ÇãÂ†¥Âêà„Å´ÂÖ•„Çå„Çã
                return hasRightRidge;
            }
        }

        // „Ç®„É™„Ç¢ÂÜÖ„Åß„ÅÆÈÄöË∑ØÈ†ÜÂ∫è„ÇíÂèñÂæó
        function getLaneSequence(areaNumber, direction) {
            if (direction === 'right') {
                // ÊôÇË®àÂõû„Çä
                if (areaNumber <= 4) {
                    return [1, 2, 3, 4, 5]; // „Ç®„É™„Ç¢1-4: ÈÄöË∑Ø1,2,3,4,5
                } else {
                    return [5, 4, 3, 2, 1]; // „Ç®„É™„Ç¢5-8: ÈÄöË∑Ø5,4,3,2,1
                }
            } else {
                // ÂèçÊôÇË®àÂõû„ÇäÔºàÊôÇË®àÂõû„Çä„ÅÆÈÄÜÈ†ÜÔºâ
                if (areaNumber <= 4) {
                    return [5, 4, 3, 2, 1]; // „Ç®„É™„Ç¢1-4: ÈÄöË∑Ø5,4,3,2,1
                } else {
                    return [1, 2, 3, 4, 5]; // „Ç®„É™„Ç¢5-8: ÈÄöË∑Ø1,2,3,4,5
                }
            }
        }

        // ÈñãÂßã„Ç®„É™„Ç¢„ÉªÈÄöË∑Ø„ÅÆÊ®™Â∫ßÊ®ô„ÇíÂèñÂæó
        function getStartLaneX(robotId) {
            const startAreaId = `startArea${robotId}`;
            const startLaneId = `startLane${robotId}`;
            
            const startArea = parseInt(document.getElementById(startAreaId).value);
            const startLane = parseInt(document.getElementById(startLaneId).value);
            
            const laneEntrance = getLaneEntrance(startArea, startLane);
            return laneEntrance.x;
        }

        // ‰∏≠Â§ÆÈÄöË∑Ø„Åß„ÅÆÁßªÂãïÊñπÂêë„ÇíÂèñÂæó
        function getCentralPathDirection(areaNumber, rotationDirection) {
            if (rotationDirection === 'right') {
                // ÊôÇË®àÂõû„Çä: „Ç®„É™„Ç¢1-4„ÅßÂè≥„ÄÅ„Ç®„É™„Ç¢5-8„ÅßÂ∑¶
                return areaNumber <= 4 ? 'right' : 'left';
            } else {
                // ÂèçÊôÇË®àÂõû„Çä: „Ç®„É™„Ç¢5-8„ÅßÂè≥„ÄÅ„Ç®„É™„Ç¢1-4„ÅßÂ∑¶  
                return areaNumber >= 5 ? 'right' : 'left';
            }
        }

        // „É≠„Éú„ÉÉ„Éà„ÅÆ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞„Åô„ÇãÈñ¢Êï∞
        function updateRobotPosition(robotId, x, y, angle = 0) {
            robotPositions[`robot${robotId}`] = { x, y, angle };
            drawFarm(); // „Éû„ÉÉ„Éó„ÇíÂÜçÊèèÁîª
        }
        
        // ÂàùÊúüÊèèÁîª
        drawFarm();
        
        // Á∑®ÈõÜ„É¢„Éº„Éâ„ÅÆÁä∂ÊÖã
        let isEditMode = false;
        
        // „Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
        function updateButtonStates() {
            const editBtn = document.getElementById('editBtn');
            const applyBtn = document.getElementById('applyBtn');
            const clearBtn = document.getElementById('clearBtn');
            
            if (isEditMode) {
                // Á∑®ÈõÜ„É¢„Éº„Éâ‰∏≠
                editBtn.disabled = true;
                editBtn.style.backgroundColor = '#c8e6c9'; // ËñÑ„ÅÑ„Ç∞„É¨„ÉºÁ∑ë
                applyBtn.disabled = false;
                applyBtn.style.backgroundColor = '#66bb6a'; // ÈÄöÂ∏∏„ÅÆÁ∑ë
                clearBtn.disabled = false;
                clearBtn.style.backgroundColor = '#a5d6a7'; // ÈÄöÂ∏∏„ÅÆËñÑÁ∑ë
            } else {
                // Á∑®ÈõÜ„É¢„Éº„ÉâÂ§ñ
                editBtn.disabled = false;
                editBtn.style.backgroundColor = '#81c784'; // ÈÄöÂ∏∏„ÅÆÁ∑ë
                applyBtn.disabled = true;
                applyBtn.style.backgroundColor = '#e0e0e0'; // „Ç∞„É¨„Éº
                clearBtn.disabled = true;
                clearBtn.style.backgroundColor = '#e0e0e0'; // „Ç∞„É¨„Éº
            }
        }
        
        // Á∑®ÈõÜ„É¢„Éº„ÉâÈñãÂßã
        function enableEditMode() {
            if (isEditMode) return; // Êó¢„Å´Á∑®ÈõÜ„É¢„Éº„Éâ„ÅÆÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            
            isEditMode = true;
            const selects = document.querySelectorAll('#detailSettings select');
            
            // „Çª„É¨„ÇØ„Éà„Éú„ÉÉ„ÇØ„Çπ„ÇíÊúâÂäπÂåñ
            selects.forEach(select => select.disabled = false);
            
            // „Éú„Çø„É≥Áä∂ÊÖã„ÇíÊõ¥Êñ∞
            updateButtonStates();
            
            console.log('Á∑®ÈõÜ„É¢„Éº„ÉâÈñãÂßã');
        }
        
        // Ë®≠ÂÆö„ÇíÂèçÊò†
        function applySettings() {
            if (!isEditMode) {
                console.log('Á∑®ÈõÜ„É¢„Éº„Éâ„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            // Ë®≠ÂÆöÂÄ§„Çí‰øùÂ≠òÔºàÂÆüÈöõ„ÅÆÂá¶ÁêÜ„ÅØ„Åì„Åì„Å´ÂÆüË£ÖÔºâ
            console.log('Ë®≠ÂÆö„ÇíÂèçÊò†„Åó„Åæ„Åó„Åü');
            
            // Á∑®ÈõÜ„É¢„Éº„Éâ„ÇíÁµÇ‰∫Ü
            exitEditMode();
        }
        
        // Á∑®ÈõÜ„É¢„Éº„ÉâÁµÇ‰∫Ü
        function exitEditMode() {
            isEditMode = false;
            const selects = document.querySelectorAll('#detailSettings select');
            
            // „Çª„É¨„ÇØ„Éà„Éú„ÉÉ„ÇØ„Çπ„ÇíÁÑ°ÂäπÂåñ
            selects.forEach(select => select.disabled = true);
            
            // „Éú„Çø„É≥Áä∂ÊÖã„ÇíÊõ¥Êñ∞
            updateButtonStates();
            
            console.log('Á∑®ÈõÜ„É¢„Éº„ÉâÁµÇ‰∫Ü');
        }
        
        // „ÇØ„É™„Ç¢Ê©üËÉΩÔºà„ÇØ„Ç§„ÉÉ„ÇØË®≠ÂÆö„ÅÆÂÄ§„Å´Êàª„ÅôÔºâ
        function clearToPreset() {
            if (!isEditMode) {
                console.log('Á∑®ÈõÜ„É¢„Éº„Éâ„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            console.log('„ÇØ„Ç§„ÉÉ„ÇØË®≠ÂÆö„ÅÆÂÄ§„Å´„É™„Çª„ÉÉ„Éà');
            // ÁèæÂú®„ÅÆ„Éó„É™„Çª„ÉÉ„ÉàÂÄ§„ÇíÈÅ©Áî®
            applyPreset();
        }
        
        // „Éö„Éº„Ç∏„É≠„Éº„ÉâÊôÇ„Å´„Éá„Éï„Ç©„É´„Éà„Éó„É™„Çª„ÉÉ„Éà„ÇíÈÅ©Áî®
        window.addEventListener('DOMContentLoaded', function() {
            applyPreset();
            // ÂàùÊúü„Éú„Çø„É≥Áä∂ÊÖã„ÇíË®≠ÂÆö
            updateButtonStates();
            
            // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„ÇπÊßãÈÄ†„ÇíÁîüÊàê
            createLaneCheckboxes();
            
            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
            document.getElementById('speedSlider').addEventListener('input', updateSpeedValue);
            document.getElementById('delayT7L').addEventListener('change', updateDelaySettings);
            document.getElementById('delayT7R').addEventListener('change', updateDelaySettings);
            
            // ÂàùÊúüÂÄ§„ÇíË®≠ÂÆö
            updateSpeedValue();
            updateDelaySettings();
        });
    </script>
</body>
</html>